{"updatedAt":"2025-08-04T10:27:59.000Z","createdAt":"2025-08-03T19:22:56.428Z","id":"UuGlXqzkWJof7DaM","name":"My workflow 3","active":false,"isArchived":false,"nodes":[{"parameters":{"promptType":"define","text":"=give me 10 the sources of news,articles,source link as well as the government portals which is available globally(take example : India/europe/usa) based on the categories  {{ $json.Category }} ","hasOutputParser":true,"options":{"systemMessage":"=You are an AI assistant. Your task is to return structured information about global or regional news portals, government websites, and industry sources that publish relevant content for sectors and business interests aligned with Shiva Engineering Services (SES).\n\nSES operates in:\n- Chemicals, agrochemicals, polymers, resins, petrochemicals, and specialty chemicals\n- Masterbatch, coatings, battery recycling, and low-carbon fuels\n- Industrial infrastructure, pharma, food processing, and GMP facilities\n\nReturn sources that regularly publish:\n- Industry-specific news and developments\n- Government tenders and procurement announcements\n- Investment, expansion, or project activity\n- Technical innovations and sector-focused market intelligence\n- consider categories provided by user also.\n\nFor each source, return a valid JSON object with the following fields:\n- source_name\n- source_id\n- location\n- base_url (in http format)\n- category\n- source_type (news, gov, industry, etc.)\n- rss_feed_url (or null if not available)\n- crawlable (yes / no / partial)\n\nRespond only with a valid JSON array. Do not include explanations, comments, markdown, or extra text.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[1552,736],"id":"0a89fc35-7b82-42fe-b5c9-7b85b976883b","name":"global_search","retryOnFail":true,"maxTries":2,"waitBetweenTries":5000,"executeOnce":true},{"parameters":{"jsonSchemaExample":"[\n  {\n    \"source_name\": \"Business Today India\",\n    \"source_id\":\"SRC1\",\n    \"location\": \"India\",\n    \"base_url\": \"https://www.businesstoday.in\",\n    \"category\": \"chemical\",\n    \"source_type\": \"news\",\n    \"rss_feed_url\": \"https://www.businesstoday.in/rssfeed.xml\",\n    \"crawlable\": \"yes\"\n  }\n]\n","autoFix":true},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[1648,960],"id":"9b5fba3e-fff8-469c-a1d1-61ce28961bde","name":"Structured Output Parser"},{"parameters":{"modelName":"models/gemini-2.5-pro","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[1504,1024],"id":"852a3cb1-f065-41eb-9499-a003d7d6565a","name":"Google Gemini Chat Model"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[2128,736],"id":"c7bef4e2-2c48-487b-bf34-7342e1be35cd","name":"Loop Over Items","retryOnFail":false,"executeOnce":false},{"parameters":{"jsCode":"let combined = [];\n\nfor (const item of items) {\n  const outputs = item.json.output || [];\n  \n  for (const entry of outputs) {\n    combined.push({\n      json: {\n        source_name: entry.source_name,\n        source_id: entry.source_id,\n        location: entry.location,\n        base_url: entry.base_url,\n        category: entry.category,\n        source_type: entry.source_type,\n        rss_feed_url: entry.rss_feed_url === \"null\" ? null : entry.rss_feed_url,\n        crawlable: entry.crawlable\n      }\n    });\n  }\n}\n\nreturn combined;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1920,736],"id":"d8f9a9ee-6da4-4c5e-9b38-fe2dc90f1cec","name":"Code"},{"parameters":{"operation":"getAll","tableId":"Categories","returnAll":true,"filterType":"none"},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1040,720],"id":"04352427-4e51-440b-996a-60a99f7832d1","name":"get_categories"},{"parameters":{"operation":"Scrape single URL","url":"={{ $json.base_url }}"},"type":"@apify/n8n-nodes-apify.apify","typeVersion":1,"position":[2336,752],"id":"e328c1c6-dbdd-4408-8cd8-16cd05b3b47b","name":"Scrape single URL","executeOnce":false,"alwaysOutputData":true,"credentials":{"apifyApi":{"id":"gbtsvl6BA991rdtH","name":"Apify account"}},"onError":"continueRegularOutput"},{"parameters":{"jsCode":"// Run once for all items\nfor (const item of $input.all()) {\n  const status = item.json.crawl?.httpStatusCode;\n\n  // Default values\n  item.json.is_valid = false;\n  item.json.validation_status = \"unknown\";\n  item.json.checked_at = new Date().toISOString();\n\n  if (status >= 200 && status < 300) {\n    item.json.is_valid = true;\n    item.json.crawlable = \"yes\";\n    item.json.validation_status = \"ok\";\n  } else if ([301, 302, 307, 308].includes(status)) {\n    item.json.is_valid = true;\n    item.json.crawlable = \"yes\";\n    item.json.validation_status = \"redirect\";\n  } else if (status === 403) {\n    item.json.is_valid = true;\n    item.json.crawlable = \"manual_only\";\n    item.json.validation_status = \"blocked_by_protection\";\n  } else if ([401, 503].includes(status)) {\n    item.json.is_valid = true;\n    item.json.crawlable = \"maybe\";\n    item.json.validation_status = \"restricted_or_unavailable\";\n  } else if (status === 404 || status === 410) {\n    item.json.is_valid = false;\n    item.json.crawlable = \"no\";\n    item.json.validation_status = \"not_found\";\n  }\n\n  // Store original status for audit\n  item.json.http_status_code = status ?? null;\n}\n\nreturn $input.all();"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2512,752],"id":"28d736ed-0f7e-4a03-8b67-1b7f8623bc9b","name":"http_status_code"},{"parameters":{"operation":"getAll","tableId":"newspaper_sources_link","returnAll":true,"filters":{"conditions":[{"keyName":"base_url","condition":"eq","keyValue":"={{ $json.url }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[2832,736],"id":"825033e0-9eb3-4dbc-882d-8d8fc5921628","name":"checking_duplicate_row","alwaysOutputData":true,"retryOnFail":false,"executeOnce":true,"onError":"continueRegularOutput"},{"parameters":{"tableId":"newspaper_sources_link","fieldsUi":{"fieldValues":[{"fieldId":"source_name","fieldValue":"={{ $('Loop Over Items').item.json.source_name }}"},{"fieldId":"location","fieldValue":"={{ $('Loop Over Items').item.json.location }}"},{"fieldId":"rss_feed_url","fieldValue":"={{ $('Loop Over Items').item.json.rss_feed_url }}"},{"fieldId":"base_url","fieldValue":"={{ $('Loop Over Items').item.json.base_url }}"},{"fieldId":"category","fieldValue":"={{ $('Loop Over Items').item.json.category }}"},{"fieldId":"crawlable","fieldValue":"={{ $('If4').item.json.crawlable }}"},{"fieldId":"is_valid","fieldValue":"={{ $('If4').item.json.is_valid }}"},{"fieldId":"checked_at","fieldValue":"={{ $('If4').item.json.checked_at }}"},{"fieldId":"validation_status","fieldValue":"={{ $('If4').item.json.validation_status }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[3344,720],"id":"6aa0228e-0cd4-40a8-9db5-aca4ee39a13b","name":"Create a new row"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1264,720],"id":"995114d9-8588-4a6c-bf70-ebe3150fa791","name":"Loop Over Items1"},{"parameters":{"modelName":"models/gemini-2.5-flash-lite","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[1648,1152],"id":"326e1535-0d1f-41f8-bc5a-e27f517a0808","name":"Google Gemini Chat Model1"},{"parameters":{"content":"## Phase 0 : Global Discovery of news","height":672,"width":2720,"color":3},"type":"n8n-nodes-base.stickyNote","position":[816,640],"typeVersion":1,"id":"e332a65b-c2e4-40bf-8087-46e2cd2881d7","name":"Sticky Note"},{"parameters":{"operation":"getAll","tableId":"keywords_web_scraping","filterType":"none"},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[1200,2096],"id":"8b00e541-55b6-45a7-ae61-8547734f99e7","name":"get-keywords"},{"parameters":{"operation":"getAll","tableId":"target_companies_ses","returnAll":true,"filterType":"none"},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[1344,2096],"id":"086bff1f-5f9e-4d90-8ea5-823501f2e99e","name":"get_target_companies"},{"parameters":{"operation":"getAll","tableId":"newspaper_sources_link","returnAll":true,"filterType":"none"},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[272,1792],"id":"619d9665-538f-4195-a5f2-ed9d4dd54362","name":"get_source_links"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[640,1792],"id":"dd3ef1d8-b0d1-4d48-8989-58b054975d98","name":"Loop Over Items2"},{"parameters":{"promptType":"define","text":"=generate search url for the given base url.\nbase url: {{ $json.base_url }}","options":{"systemMessage":"=You are an intelligent assistant that generates effective and crawlable search URLs for structured discovery of projects, industrial activity, government policies, and business updates‚Äîspecifically aligned to Shiva Engineering Services (SES)'s domain of expertise.\n\nYour Goal:\nGenerate high-quality search URLs for each source using either:\n- `base_url` ({{ $json.base_url }})\n- or `rss_feed_url` ({{ $json.rss_feed_url }}) only if it supports keyword filtering.\n\n---\n\nURL Construction Rules:\n\n1. Use `rss_feed_url` only if it includes keyword filtering.\n2. Otherwise, use `base_url` and construct search URLs using one of these formats (based on site structure):\n   - `/search/{keyword}`\n   - `/?q={keyword}`\n   - `/tag/{keyword}`\n   - `/topic/{keyword}`\n   - `/category/{keyword}`\n   - `/news/{keyword}`\n   - `/articles/{keyword}`\n\n3. Avoid using `?s=` unless it's the only pattern supported.\n\n---\n\nInput Data You Have Access To:\n\n- `base_url` or `rss_feed_url`\n- List of `category_keywords` from Supabase (e.g., hydrogen, refinery, digitization, ammonia, etc.)\n- List of `target_companies` from Supabase (e.g., Vedanta, GAIL, etc.)\n\n---\n\nUse These SES-Specific Focus Areas to Filter/Generate Smart Keywords:\n\nShiva Engineering Services focuses on:\n- EPC, PMC, Detailed Engineering, and FEED\n- Chemical & Petrochemical Plants\n- Hydrogen, Ammonia, Methanol, and Biofuel Projects**\n- Greenfield/Brownfield Projects\n- Refinery & Downstream Processing\n- Utility Systems, Process Engineering, Process Safety\n- Battery Storage, Renewable Energy, Digitization in Plants\n- Industrial Automation & Smart Plant Solutions\n\nYou may enhance matching of keywords or filter out weak/generic ones using this focus.\n\nExclude Weak Terms Like:\n- approval, update, general, announcement, expansion, advanced\n\n\nOutput Format:\n\nReturn a single flat JSON array of valid search URL strings.\nExample Output:\n\n[\n  \"https://www.indianchemicalnews.com/search/hydrogen\",\n  \"https://www.indianchemicalnews.com/search/refinery\",\n  \"https://www.indianchemicalnews.com/search/epc\",\n  \"https://www.indianchemicalnews.com/search/gail\",\n  \"https://www.indianchemicalnews.com/search/vedanta\"\n]\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[1040,1808],"id":"e54fec44-e7d1-402b-90a1-9ec0aeda28e9","name":"gen_search-url","retryOnFail":false,"waitBetweenTries":5000,"executeOnce":true},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[912,2016],"id":"e44b2464-3f46-44a1-8161-06ab69224ae4","name":"Google Gemini Chat Model2"},{"parameters":{"jsCode":"const raw = $input.first().json.output;\n\n// Step 1: Clean up the string\nlet cleaned = raw\n  .replace(/```json/g, '')\n  .replace(/```/g, '')\n  .replace(/\\\\n/g, '\\n')\n  .replace(/\\\\+\"/g, '\"')\n  .replace(/\\\\\"/g, '\"')\n  .replace(/\",\\s*$/gm, '\"') // remove trailing comma from end of JSON lines\n  .replace(/^\\s*\\[|\\]\\s*$/g, ''); // remove surrounding brackets\n\n// Step 2: Split lines and sanitize\nlet urls = cleaned\n  .split('\\n')\n  .map(line =>\n    line\n      .trim()\n      .replace(/^\"|\"$/g, '')  // remove surrounding quotes\n      .replace(/\\\\$/, '')     // remove trailing backslash\n  )\n  .filter(url => url.startsWith(\"http\"));\n\n// Step 3: Reverse the list and return clean results\nreturn urls.reverse().map(url => ({\n  json: {\n    search_url: url\n  }\n}));\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1456,1808],"id":"5c451674-7e0b-4f03-8d33-9d5d7d76aa2a","name":"Code1"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1696,1808],"id":"f8d65821-d3dd-4bc6-a107-01205e51e11a","name":"Loop Over Items3"},{"parameters":{"operation":"Scrape single URL","url":"={{ $json.search_url }}"},"type":"@apify/n8n-nodes-apify.apify","typeVersion":1,"position":[1920,1824],"id":"455340f4-d996-4f48-b79e-1798e9c6ff44","name":"Scrape single URL1","retryOnFail":true,"waitBetweenTries":5000,"credentials":{"apifyApi":{"id":"gbtsvl6BA991rdtH","name":"Apify account"}},"onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4b4bf2b2-d305-4c0b-875b-a64250e77b63","leftValue":"={{ $json.markdown }}","rightValue":"No record found","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2128,1824],"id":"3f04c1b9-3437-4e08-9f5f-7cd4424a0759","name":"If2"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[800,736],"id":"f8abc9d6-7960-4d3f-8c9f-6b3898fa4866","name":"When clicking ‚ÄòExecute workflow‚Äô"},{"parameters":{"url":"={{ $('Loop Over Items3').item.json.search_url }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2304,1840],"id":"ee85aa02-a61d-44e6-ae84-3cd233bf7408","name":"url-to-html"},{"parameters":{"text":"={{ $json.data }}","attributes":{"attributes":[{"name":"output","description":"output for article links"}]},"options":{"systemPromptTemplate":"=\nYou are an intelligent, precise, and reliable HTML content extraction agent designed to process structured news data from business, industrial, and engineering-related websites.\n\nYour task is to extract structured metadata only from within each article block (such as <div> or <article>). Do not infer or reuse page-level information (like global dates or headlines).\n\nEach article is expected to be enclosed within its own HTML container. For every article block, extract the following fields:\n\nFields to extract:\narticle_url: The full URL of the article. Extract from <a> tag inside the same block.\n\narticle_id: Extract from the article URL (last numeric ID in the slug). If not available, generate a simple hash of the URL or title.\n\nsource_name:  {{ $('Loop Over Items2').item.json.base_url }}.\n\ntitle: The article title or headline ‚Äî usually the anchor text of <a> inside the block.\n\nDate: Extract the actual article date if it's present within the same article block ‚Äî such as a <span>, <div>, or <p> near the title. This must not be reused from the page header. If not found, return null.\nfor example:\n<div class=\"article\">\n  <div class=\"date\">July 30, 2025</div>\n  <a href=\"/some-news.html\">Title</a>\n</div>\n\n\nsummary: A short lead paragraph, if present in the same article block.\n\ncategory: Hardcode this based on the scraping context and {{ $('Loop Over Items2').item.json.category }}..\n\ncompany_mentioned: List of companies referenced in the article title or summary (use simple regex, not NER).\n\nproject_keywords: Extract project-specific terms (e.g., EPC, hydrogen, ammonia, refinery, investment, MoU, expansion, greenfield, etc.) from the visible text in the same block.\n\nlocation: Mention any geographic location (city, state, region) found within the article block.\n\nextracted_text: The full visible text content of the article block (cleaned of HTML).\n\nOutput format:\nReturn a clean JSON array of article objects.\n\nExtraction Rules:\nDo not hallucinate or reuse values from outside the article block.\n\nOnly include data that is visibly present in the HTML content inside each article block.\n\nSet any missing field to null.\n\nClean all output of excess whitespace, HTML tags, and irrelevant elements (ads, sidebars, navigation).\n\nNever include markdown (```json etc.) ‚Äî return only raw JSON.\n"}},"type":"@n8n/n8n-nodes-langchain.informationExtractor","typeVersion":1.2,"position":[2448,1840],"id":"f0685095-a0c3-4a77-9a13-b5de277f7e87","name":"Article Information Extractor"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[2464,2064],"id":"68fce9eb-88e4-40ee-8bb4-9d3f4394ee2c","name":"Google Gemini Chat Model3"},{"parameters":{"jsCode":"// Step 1: Get the raw nested string\nlet raw = $input.first().json.output.output;\n\n// Step 2: Clean markdown (if any) ‚Äî only if it's a string\nif (typeof raw === 'string') {\n  raw = raw\n    .replace(/```json/gi, '')\n    .replace(/```/g, '')\n    .trim();\n} else {\n  throw new Error(\"Expected a string in output.output but got: \" + typeof raw);\n}\n\n// Step 3: Parse\nlet articles;\ntry {\n  articles = JSON.parse(raw);\n  if (!Array.isArray(articles)) throw new Error(\"Parsed result is not an array\");\n} catch (err) {\n  throw new Error(\"Failed to parse JSON: \" + err.message);\n}\n\n// Step 4: Normalize\nconst DEFAULT_SOURCE_NAME = \"https://www.indianchemicalnews.com\";\nconst DEFAULT_CATEGORY = \"chemical\";\n\nreturn articles.map((article, index) => {\n  const articleId =\n    article.article_id ||\n    article.article_url?.split('-').pop() ||\n    `missing-id-${index}`;\n\n  return {\n    json: {\n      article_url: article.article_url || null,\n      article_id: articleId,\n      source_name: DEFAULT_SOURCE_NAME,\n      title: article.title || null,\n      published_date: article.Date || null,\n      summary: article.summary ?? null,\n      category: DEFAULT_CATEGORY,\n      company_mentioned: Array.isArray(article.company_mentioned)\n        ? article.company_mentioned\n        : article.company_mentioned\n        ? [article.company_mentioned]\n        : [],\n      project_keywords: Array.isArray(article.project_keywords)\n        ? article.project_keywords\n        : article.project_keywords\n        ? [article.project_keywords]\n        : [],\n      location: Array.isArray(article.location)\n        ? article.location\n        : article.location\n        ? [article.location]\n        : [],\n      extracted_text: article.extracted_text || null\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2784,1840],"id":"2bc7a97e-40de-4804-823b-122278ab77ed","name":"article_data_formatting"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[3104,1840],"id":"a6d847f4-a4db-4c38-8335-6454fead1a6b","name":"Loop Over Items4"},{"parameters":{"promptType":"define","text":"=This is the title of a news article: \"{{ $('Loop Over Items4').item.json.title }}\". \narticle link:\"{{ $('Loop Over Items4').item.json.article_url }}\" Based on just this title, determine if this article might be relevant to Shiva Engineering Services (SES) in any way ‚Äî such as project execution, EPC, EPCM, engineering design, manufacturing capacity expansion, utilities, revamp, shutdown, or industrial investment.\n\n\n","options":{"systemMessage":"=You are a domain expert working for Shiva Engineering Services (SES), a company specializing in providing the following services:\n\n- EPC and EPCM project execution\n- Basic & detailed engineering design\n- Greenfield and brownfield plant design\n- Project management consultancy (PMC)\n- Construction management\n- Plant utilities & infrastructure design\n- Process safety and HAZOP studies\n- Shutdown and revamp projects\n- Procurement assistance and fabrication support\n- Sector focus: chemical, petrochemical, hydrogen, oil & gas, fertilizers, specialty chemicals, pharmaceuticals, renewable energy\n\nYour task is to review the *title* of a news article and determine if it might be relevant to SES in any way ‚Äî such as potential involvement in design, engineering, project execution, utilities, or expansion.\n\nRespond with:\n- **Yes** ‚Äì if the article title suggests any project activity (expansion, manufacturing, new plant, investment, technology adoption, capacity increase, MoU, etc.) that may require SES services.\n- **No** ‚Äì if the article is likely not related to engineering or industrial project activities (e.g., HR, finance-only updates, minor policy, non-industrial news).\n\nBe brief. Include a 1-line reason after your yes/no judgment.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[3792,1840],"id":"021318b3-4c4b-4bd5-98cf-a2bc2dd4ad8a","name":"AI Agent article_link_filter"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[3824,2096],"id":"41ed9392-f977-40ad-8f4d-40cfe75023ab","name":"Google Gemini Chat Model4"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"af924c1d-54e1-4c74-855a-074bebbae91b","leftValue":"={{ $json.output }}","rightValue":"Yes","operator":{"type":"string","operation":"contains"}},{"id":"112725a6-8967-44df-8e4d-0f06094ad5dc","leftValue":"={{ $json.output }}","rightValue":"yes","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[4144,1840],"id":"9de477b6-fb99-458d-a23c-cf5027cb98f7","name":"If3"},{"parameters":{"tableId":"Raw_article","fieldsUi":{"fieldValues":[{"fieldId":"Article_id","fieldValue":"={{ $('Loop Over Items4').first().json.article_id}}"},{"fieldId":"article_link","fieldValue":"={{ $('Loop Over Items4').first().json.article_url }}"},{"fieldId":"article_date","fieldValue":"={{ $('Loop Over Items4').first().json.published_date }}"},{"fieldId":"article_title","fieldValue":"={{ $('Loop Over Items4').first().json.title }}"},{"fieldId":"article_keyword","fieldValue":"={{ $('Loop Over Items4').first().json.project_keywords }}"},{"fieldId":"category","fieldValue":"={{ $('Loop Over Items4').first().json.category }}"},{"fieldId":"extracted_text","fieldValue":"={{ $('Loop Over Items4').first().json.extracted_text }}"},{"fieldId":"location","fieldValue":"={{ $('Loop Over Items4').first().json.location }}"},{"fieldId":"company_mentioned","fieldValue":"={{ $('Loop Over Items4').first().json.company_mentioned }}"},{"fieldId":"status_to_be_scraped","fieldValue":"true"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[4304,1824],"id":"eac99680-c67f-4df4-8e98-8413e97f14f1","name":"Create a row","credentials":{"supabaseApi":{"id":"Yw4wgkIKcwecx5YL","name":"Supabase account"}}},{"parameters":{"content":"## phase 2 : getting the required article links from search url","height":640,"width":4448},"type":"n8n-nodes-base.stickyNote","position":[128,1664],"typeVersion":1,"id":"a075b80d-0083-4f89-bf65-ee2124ca614b","name":"Sticky Note1"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1312,2960],"id":"5accd686-fa14-4d93-abde-4b0244e5bb16","name":"Loop Over Items5"},{"parameters":{"url":"={{ $json.article_link }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1680,2960],"id":"a5983e34-ce1f-4bf5-b05f-f77e42609809","name":"article-url-to-html"},{"parameters":{"text":"={{ $json.data }}","attributes":{"attributes":[{"name":"published_date","description":"The publication date (YYYY-MM-DD)"},{"name":"extracted_text","description":"Cleaned full article content"}]},"options":{"systemPromptTemplate":"=You are an intelligent HTML parsing agent designed to extract structured content from article web pages.\n\nYour task is to extract the following information from a raw HTML string of a news article:\n\n1. published_date ‚Äì The publication date of the article in YYYY-MM-DD format. Look for patterns like ‚ÄúJuly 29, 2025‚Äù near the top of the article.\n2. extracted_text ‚Äì The full cleaned main body of the article, composed of all paragraph tags under the main article content area. Remove any sidebars, footers, ads, or navigation clutter.\n\n### Instructions:\n- Use class names like: detail-para, blog-details-desc, article-content, or similar to locate the article content.\n- Extract all meaningful <p> or <div> tags inside the main container and join them as paragraphs.\n- Parse the publication date using a natural language pattern like ‚ÄúJuly 29, 2025‚Äù.\n- If the date cannot be parsed into a standard format, leave it as a string. If not found, return null.\n- If content is not found, return an empty string.\n\n"}},"type":"@n8n/n8n-nodes-langchain.informationExtractor","typeVersion":1.2,"position":[1840,2960],"id":"e330cac9-6444-4592-9685-f9e649c4cf26","name":"extracting-article-content"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[1808,3168],"id":"0498d393-5d7a-44fd-a01f-6de7010968f3","name":"Google Gemini Chat Model5"},{"parameters":{"amount":2},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2640,2960],"id":"ddc187a9-b962-49a7-a586-1d2b1f1d6e47","name":"Wait3","webhookId":"a2008825-a817-439f-930a-c6d9a80938a4"},{"parameters":{"sessionIdType":"customKey","sessionKey":"1","contextWindowLength":5000},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[2816,3168],"id":"40df98aa-0cde-4c7a-bbe9-73b492af684e","name":"Simple Memory"},{"parameters":{"promptType":"define","text":"=Please analyze the following article content and assess whether it's relevant for Shiva Engineering Services (SES), based on their scope and industry focus.\nextracted content:\n {{ $json.output.extracted_text }}","hasOutputParser":true,"options":{"systemMessage":"=You are an expert industry intelligence analyst.\n\nYour role is to analyze the full plain-text content of a business or industrial news article and extract actionable, structured insights in line with the following business context:\n\n---\n\n### Client Background:\n\nShiva Engineering Services (SES) is an engineering and EPCM firm operating in:\n- EPC, EPCM, PMC, basic and detailed design\n- Utility systems, revamp and shutdown projects\n- Consulting for greenfield, brownfield, or capacity expansion\n\nSectors of focus:\n- Chemicals, Petrochemicals, Oil & Gas, Hydrogen, Fertilizers\n- Specialty Chemicals, Renewable Energy, Pharma, Industrial Infrastructure\n\n---\nYour Tasks:\n\n1. Determine Relevance to SES:\n   Assess whether the article presents a potential opportunity or signal for SES. It's relevant if it involves:\n   - New project announcements (greenfield, brownfield, capacity expansion)\n   - Utility system requirements or shutdowns/revamps\n   - EPC or EPCM project scope (even indirectly)\n   - MoUs, JV, partnerships, site activity\n   - Regulatory approvals, tenders, or investment activity\n   - Any news that hints at project execution, facility upgrades, or capital engineering plans\n\n2. Map Relevance Insight:\n   If relevant, clearly answer the following:\n   - what is the core opportunity or situation\n   - why SES should care\n   - how SES may be involved (design, PMC, utility, etc.)\n   - when SES might need to act (e.g., timeline, approval date, stage)\n\n3.Extract Structured Article Intelligence:\n   Regardless of SES relevance, extract all other insights that may be useful:\n   - Project keywords (EPCM, hydrogen, investment, revamp, shutdown, MoU, etc.)\n   - Companies involved\n   - Location (city, state, site, or country)\n   - Project type (e.g., MoU, expansion, greenfield, shutdown)\n   - Investment info (amounts, use of funds)\n   - Financial results or strategic financial shifts\n   - Technology or innovation strategies (digital, AI, sustainability, etc.)\n   - Regulatory updates or environmental clearances\n   - Leadership or executive changes\n\nReturn your response strictly in the following JSON schema:\n{\n  \"article_id\": \"string (from metadata)\",\n  \"article_link\": \"string (from metadata)\",\n  \"category\": \"string (e.g., Chemical, Hydrogen)\",\n  \"relevancy\": true or false,\n  \"proceed\": true or false,\n  \"insights_summary\": \"Concise merged answer of what + why + how + when if relevant. Otherwise null.\",\n  \"project_details_scope\": \"Any additional project-specific scope or execution details if found.\",\n  \"project_type\": \"e.g. MoU, expansion, shutdown, greenfield, null if not found\",\n  \"project_keywords\": [\"list\", \"of\", \"relevant\", \"terms\"],\n  \"location\": [\"city\", \"site\", \"state\"],\n  \"companies_mentioned\": [\"company1\", \"company2\"]\n}\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[2800,2960],"id":"4fe1871f-31aa-449c-ada9-c5ba915fdb11","name":"Article-analyser-SES","retryOnFail":true,"waitBetweenTries":5000,"maxTries":2,"onError":"continueRegularOutput"},{"parameters":{"jsonSchemaExample":"{\n  \"article_id\": \"26949\",\n  \"article_link\": \"https://www.indianchemicalnews.com/general/shell-completes-sale-of-colonial-enterprises-stake-to-brookfield-subsidiary-26998\",\n  \"category\": \"Chemical\",\n  \"relevancy\": true,\n  \"proceed\": true,\n  \"insights_summary\": \"Expansion of Propylene Glycol facility by Manali Petrochemicals in Chennai. | The article announces a capacity expansion at a chemical plant, which may involve utility or PMC services. | SES could provide engineering support, detailed design, or utility system upgrades. | The project has received consent in July 2025 and is ready for operational ramp-up.\",\n  \"project_details_scope\": \"Manali Petrochemicals has received CTO for expanded Propylene Glycol facility valid till 2030.\",\n  \"project_type\": \"Capacity Expansion\",\n  \"project_keywords\": [\n    \"expansion\",\n    \"propylene glycol\",\n    \"capacity\",\n    \"consent to operate\"\n  ],\n  \"location\": [\n    \"Manali, Chennai\"\n  ],\n  \"companies_mentioned\": [\n    \"Manali Petrochemicals\",\n    \"TNPCB\"\n  ],\n  \"created_at\": \"2025-08-03T13:25:00Z\"\n}\n","autoFix":true},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[2944,3168],"id":"b22f1b32-0b5b-46a7-8299-0546c82887b0","name":"Structured Output Parser1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8088886e-0950-48be-9ced-74d9271de76b","leftValue":"={{ $json.output.relevancy }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[3152,2960],"id":"77cf7308-afae-448d-808c-5ec6c7ec285f","name":"If5"},{"parameters":{"content":"## phase 3: extracting article content","height":544,"width":1536,"color":3},"type":"n8n-nodes-base.stickyNote","position":[848,2832],"typeVersion":1,"id":"b688dc72-9cba-4f44-9a05-c5ef86ae6cc0","name":"Sticky Note2"},{"parameters":{"content":"## Phase 4 : Ai analyser for article content","height":656,"width":1104,"color":4},"type":"n8n-nodes-base.stickyNote","position":[2592,2832],"typeVersion":1,"id":"76fae681-782a-4913-afb6-664f381e4e11","name":"Sticky Note3"},{"parameters":{"amount":2,"unit":"minutes"},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[4000,2080],"id":"35580c95-f7d4-4845-86eb-1740c5465cc0","name":"Wait4","webhookId":"e57ebac5-48bc-4ee8-9c6c-2ea45304ae05"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[2912,3376],"id":"e8e470fa-bedf-488e-9772-10aa45f258ba","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"8bXvMQQb7xIYqlTW","name":"OpenAi account-pooja-linkai"}}},{"parameters":{"jsCode":"const items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const article = item.json;\n  const dateStr = article.published_date;\n\n  // Case 1: No date ‚Äî pass it for further processing\n  if (!dateStr) {\n    results.push({ json: article });\n    continue;\n  }\n\n  // Case 2: Check if date is recent (last ~4 months)\n  const publishedDate = new Date(dateStr);\n  const today = new Date();\n  const thresholdDate = new Date();\n  thresholdDate.setDate(today.getDate() - 120); // ~4 months\n\n  if (publishedDate >= thresholdDate) {\n    results.push({ json: article }); // recent, pass\n  }\n  // else: discard silently\n}\n\nreturn results;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2928,1840],"id":"cfcddc51-0fbd-4b2d-bba1-68513dba4e1c","name":"date_filter"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[2720,3312],"id":"28a1c448-338d-4bff-b868-40ec416ccfb1","name":"Google Gemini Chat Model6"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"bcf6ba17-16cd-4788-a982-01fc894cabae","leftValue":"={{ $json.status_to_be_scraped }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1504,2976],"id":"0c0b5292-ed59-4baf-b357-ff232271a5c1","name":"If6"},{"parameters":{"operation":"getAll","tableId":"Raw_article","returnAll":true},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1088,2960],"id":"0e95968c-ed8e-4ae8-9478-149e5a6cb50d","name":"get_article_links_from-raw-article-table"},{"parameters":{"tableId":"opportunity_insights","fieldsUi":{"fieldValues":[{"fieldId":"article_source","fieldValue":"={{ $json.output.article_link }}"},{"fieldId":"identified_opportunity","fieldValue":"={{ $json.output.insights_summary }}"},{"fieldId":"project_details_scope","fieldValue":"={{ $json.output.project_details_scope }}"},{"fieldId":"processed","fieldValue":"={{ $json.output.proceed }}"},{"fieldId":"created_at","fieldValue":"={{ $json.output.created_at }}"},{"fieldId":"location","fieldValue":"={{ $json.output.location }}"},{"fieldId":"company_name","fieldValue":"={{ $json.output.companies_mentioned }}"},{"fieldId":"published_date_article","fieldValue":"={{ $('extracting-article-content').item.json.output.published_date }}"},{"fieldId":"insight_id","fieldValue":"={{ $json.output.article_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[3344,2944],"id":"8ec10ba0-8e7f-461c-a304-5c0214854339","name":"Create a row in final-table"},{"parameters":{"operation":"update","tableId":"Raw_article","filters":{"conditions":[{"keyName":"article_link","condition":"eq","keyValue":"={{ $json.article_source }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"status_to_be_scraped","fieldValue":"false"},{"fieldId":"article_date","fieldValue":"={{ $('extracting-article-content').item.json.output.published_date }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[3504,2944],"id":"807e667f-6f7b-4e9a-b312-469bc795cb3e","name":"Update row in raw_article_table_status","credentials":{"supabaseApi":{"id":"Yw4wgkIKcwecx5YL","name":"Supabase account"}}},{"parameters":{"amount":2,"unit":"minutes"},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2176,2032],"id":"ae6836a6-2a7e-4258-850e-2c05a00aee25","name":"Wait5","webhookId":"e57ebac5-48bc-4ee8-9c6c-2ea45304ae05"},{"parameters":{"amount":2,"unit":"minutes"},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1744,2080],"id":"7ca9f8d2-168f-4846-9612-63db3900268d","name":"Wait2","webhookId":"c9682d79-2aee-4525-b563-7140c6635386"},{"parameters":{"operation":"get","tableId":"Raw_article","filters":{"conditions":[{"keyName":"article_link","keyValue":"={{ $json.article_url }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[3296,1856],"id":"3a2bb612-cdc0-4b2f-a432-848475b1c794","name":"Get a row1","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"jsCode":"const items = $input.all();\n\n// Check: empty array or empty object\nif (\n  items.length === 0 ||\n  (Object.keys(items[0].json || {}).length === 0)\n) {\n  // No useful data ‚Äî allow Supabase row creation\n  return [{ json: { should_create_row: true } }];\n} else {\n  // Data exists ‚Äî don't create row\n  return [{ json: { should_create_row: false } }];\n}\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[3440,1856],"id":"a7ec4a9a-8206-4681-b2c8-88f8271d8231","name":"Code3"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"47563ab4-a197-40e5-8663-aee0223a652b","leftValue":"={{ $json.should_create_row }}","rightValue":"=false","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[3616,1856],"id":"180af96a-734b-4d48-8b6c-be3701698326","name":"If7"},{"parameters":{"jsCode":"const items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const article = item.json;\n  const dateStr = article.published_date;\n\n  // Case 1: No date ‚Äî pass for manual validation or downstream extraction\n  if (!dateStr) {\n    results.push({ json: article });\n    continue;\n  }\n\n  // Case 2: Parse and compare properly\n  const publishedDate = new Date(dateStr);\n  const today = new Date();\n  const threshold = new Date(today);\n  threshold.setDate(threshold.getDate() - 90); // Last 3 months\n\n  if (publishedDate >= threshold) {\n    results.push({ json: article }); // ‚úÖ Recent enough\n  }\n  // Else skip silently\n}\n\nreturn results;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2208,2960],"id":"65b83425-5f85-4ca8-b67c-a0e47f62582f","name":"date_filter1"},{"parameters":{"amount":2,"unit":"minutes"},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2160,3168],"id":"7802e50d-4482-4730-929c-745f1b6476b5","name":"Wait6","webhookId":"e57ebac5-48bc-4ee8-9c6c-2ea45304ae05"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fc6b6387-f19f-41d5-b498-90f47b364127","leftValue":"={{ $json.crawlable }}","rightValue":"yes","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2656,752],"id":"70a95fae-ceb0-410d-be6e-b64984e80ed6","name":"If4"},{"parameters":{"amount":30},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2576,1008],"id":"c97a005d-6933-45b9-adf4-9e6c1d1e5748","name":"Wait","webhookId":"4a99a0ce-6b66-4df1-847d-c8a8aa4cde34"},{"parameters":{"jsCode":"const items = $input.all();\n\n// Check: empty array or empty object\nif (\n  items.length === 0 ||\n  (Object.keys(items[0].json || {}).length === 0)\n) {\n  // No useful data ‚Äî allow Supabase row creation\n  return [{ json: { should_create_row: true } }];\n} else {\n  // Data exists ‚Äî don't create row\n  return [{ json: { should_create_row: false } }];\n}\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2992,736],"id":"238c48ae-a2e8-49fe-a036-7e462cc8588b","name":"Code4"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a5ed259c-ea05-44e3-b7b7-fe2c47b22c41","leftValue":"={{ $json.should_create_row }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[3152,736],"id":"594edaea-7a04-46bc-82a7-4a480f7f083e","name":"If"},{"parameters":{"amount":2,"unit":"minutes"},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1328,1024],"id":"6c25b6ea-51f8-4047-b74b-669da4b818f3","name":"Wait7","webhookId":"507b1bde-4a0d-4fe5-be96-7bdc80616f90"},{"parameters":{"jsCode":"// Reverse input array to start from the last link\nconst reversedItems = $input.all().reverse();\n\n// Optional: add a custom flag (example field)\nfor (const item of reversedItems) {\n  item.json.myNewField = 1;\n}\n\nreturn reversedItems;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[432,1792],"id":"b5a7b4f8-b008-47b5-901b-e8a729d93735","name":"Code2"},{"parameters":{"content":"## POOJA","height":3568,"width":4800,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"id":"0c326ab0-58bd-4e46-bd9c-137a7d7d261f","name":"Sticky Note4"},{"parameters":{"fieldToSplitOut":"organizations","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[6080,7888],"id":"ddfa5624-9464-4bed-bc34-b5ace853c814","name":"Split Out1"},{"parameters":{"method":"POST","url":"https://api.apollo.io/api/v1/mixed_companies/search ","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"x-api-key","value":"llf6QTT16sK_glg9JVwRwQ"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"q_organization_name\": \"{{ $json.company_name }}\"\n} ","options":{}},"id":"8696fb46-3058-4fe4-8a48-0d8de3c596e1","name":"HTTP Request6","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[5808,7888]},{"parameters":{"resource":"Datasets","datasetId":"={{ $json.defaultDatasetId }}","offset":{},"limit":10},"type":"@apify/n8n-nodes-apify.apify","typeVersion":1,"position":[7536,7856],"id":"c85e7e39-4138-4cfc-a519-3c1b53d04e53","name":"Get dataset items"},{"parameters":{"actorId":{"__rl":true,"value":"jljBwyyQakqrL1wae","mode":"list","cachedResultName":"üî•Apollo Scraper - Scrape upto 50k Leads (code_crafter/apollo-io-scraper)","cachedResultUrl":"https://console.apify.com/actors/jljBwyyQakqrL1wae/input"},"customBody":"={\n  \"totalRecords\": 500,\n    \"url\": \"{{ $json.url }}\"\n} ","timeout":{}},"type":"@apify/n8n-nodes-apify.apify","typeVersion":1,"position":[6912,7872],"id":"09cb0e63-d9e3-46d8-8b6f-63b3655d240c","name":"Run an Actor"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini-search-preview","mode":"list","cachedResultName":"GPT-4O-MINI-SEARCH-PREVIEW"},"messages":{"values":[{"content":"You are an expert business research analyst. Your task is to extract comprehensive company and project insights based on the provided user query. Your response MUST be a valid JSON object, and ONLY the JSON object. Adhere strictly to the following schema. Do not include any preamble, conversational text, or explanations outside the JSON block. If any information cannot be found or is not applicable, use an empty string (\"\") for text fields, an empty array ([]) for list fields, or \"Unknown\" for categorical fields like 'business_size' and 'project_stage'.\n\nJSON Schema to follow:\n{\n  \"company_overview\": \"string\",\n  \"recent_announcement\": \"string\",\n  \"pain_point_tag\": \"string\",\n  \"tech_stack\": [\"string\"],\n  \"business_size\": \"string\",\n  \"competitor_association\": [\"string\"],\n  \"news_mentions\": [\"string\"]\n}","role":"system"},{"content":"=Conduct a detailed research on the company: **{{ $('Loop Over Items6').item.json.company_name }}**, focusing specifically on their recent project: **{{ $('Loop Over Items6').item.json.identified_opportunity }}** which is located in **{{ $('Loop Over Items6').item.json.location }}**. The project scope is described as: {{ $('Loop Over Items6').item.json.project_details_scope }}.\n\nBased on thorough research from available public and industry sources, extract and provide the following information. Ensure the data is current and relevant to the project described:\n\n-   **company_name**: The company‚Äôs full legal name, expanded and standardized. Expand all abbreviations or acronyms (e.g. ‚ÄúLtd.‚Äù ‚Üí ‚ÄúLimited‚Äù, ‚ÄúCorp.‚Äù ‚Üí ‚ÄúCorporation‚Äù, ‚ÄúInc.‚Äù ‚Üí ‚ÄúIncorporated‚Äù, ‚ÄúPvt. Ltd.‚Äù ‚Üí ‚ÄúPrivate Limited Company‚Äù, ‚ÄúLLP‚Äù ‚Üí ‚ÄúLimited Liability Partnership‚Äù, etc.), and present in Title Case with no shorthand.\n-   **company_overview**: A comprehensive, high-level summary of the company, including its primary business, mission, and general market position.\n-   **recent_announcement**: The most recent, significant official announcement or confirmed update directly related to the project.\n-   **pain_point_tag**: Identify a key business or technical challenge that this company, or this specific project, is likely addressing or encountering.\n-   **tech_stack**: List of relevant technologies, platforms, or specific software/hardware stacks that the company uses or that are critical to the project's success. Provide this as an array of strings.\n-   **business_size**: An estimated classification of the company's size, chosen from 'Small', 'Mid', or 'Large', based on publicly available metrics (e.g., revenue, employee count, market capitalization). If exact size is unknown, provide 'Unknown'.\n-   **competitor_association**: List of primary competitors, direct rivals, or other notable companies operating in a similar market or industry as **{{ $('Fetch New Opportunities').item.json.company_name }}**. Provide this as an array of strings.\n-   **news_mentions**: A collection of significant external news articles, press releases, or prominent online mentions (provide URLs or titles) that are relevant to the company or the identified project. Provide this as an array of strings (URLs preferred).\n\nYour response must be ONLY the JSON object conforming to the schema provided in the system prompt."}]},"simplify":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[5152,7888],"id":"f7838fcd-1867-4986-bdf9-df2c169cd945","name":"Enrich Company Agent"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini-search-preview","mode":"list","cachedResultName":"GPT-4O-MINI-SEARCH-PREVIEW"},"messages":{"values":[{"content":"You are a business intelligence analyst specializing in industrial project validation. Your task is to verify the credibility of business opportunities by analyzing multiple sources and providing evidence-based assessments. Focus on manufacturing, energy, chemical, and infrastructure projects. Be thorough but efficient in your analysis. Search across all available platforms including social media, business news, and official channels.","role":"system"},{"content":"=Validate this business opportunity with high precision across multiple platforms:\n\nCOMPANY: {{ $json.company_name }}\nPROJECT: {{ $json.identified_opportunity }}\nLOCATION: {{ $json.location }}\nSCOPE: {{ $json.project_details_scope }}\n\nInstructions:\n1. Search for recent announcements, press releases, or official statements about this specific project\n2. Verify the company's involvement and project status\n3. Look for supporting evidence from credible sources including:\n   - Official company websites and press releases\n   - Government announcements and project approvals\n   - Industry reports and trade publications\n   - Business news websites (Economic Times, Business Standard, MoneyControl, etc.)\n   - Social media platforms (LinkedIn, Twitter/X, Facebook)\n   - Professional networking sites (LinkedIn company pages, employee posts)\n   - Financial news and stock exchange announcements\n   - Local and regional news sources\n   - Industry-specific publications and journals\n4. Assess the credibility level based on available information\n5. Cross-reference information across multiple sources for consistency\n\nRespond in this exact JSON format:\n{\n  \"confidence\": true/false,\n  \"sources\": [\"url1\", \"url2\", \"url3\"],\n  \"snippet\": \"Brief summary of the most compelling evidence found\",\n  \"project_status\": \"planning/construction/announced/completed\",\n\"insights_summary\":\"summary of insight/opportunity which will be helpful to craft email to outreach company\"\n  \"verification_level\": \"high/medium/low\",\n  \"source_types\": [\"official_website\", \"social_media\", \"news_article\", \"government\", \"financial_report\"]\n}"}]},"simplify":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[4064,7904],"id":"945c6242-3348-442f-b90b-6f408094f2bb","name":"Validation agent"},{"parameters":{"assignments":{"assignments":[{"id":"336074e3-b3b9-4dde-92d7-fb5af51b8ffa","name":"fullName","value":"={{ $json.first_name }} {{ $json.last_name }}","type":"string"},{"id":"da8362c5-75a5-4431-847d-fd4e02112bcc","name":"emailAddress","value":"={{ $json.email }}","type":"string"},{"id":"3c99e0e0-4184-4e85-baa0-8bb85e4e227b","name":"linkedInURL","value":"={{ $json.linkedin_url }}","type":"string"},{"id":"a45af1ff-7026-47a0-a42c-bdb3b27c8e3d","name":"seniority ","value":"={{ $json.seniority }}","type":"string"},{"id":"fa551406-a981-4fbb-babc-aa78ab10010d","name":"jobTitle","value":"={{ $json.title }}","type":"string"},{"id":"2e8d8d61-bd02-4f24-91f1-707152d99806","name":"companyName","value":"={{ $json.organization_name }}","type":"string"},{"id":"1295a702-636a-48bd-8bcd-df92162237fb","name":"location","value":"={{ $json.city }}, {{ $json.state }},{{ $json.country }}","type":"string"},{"id":"0072b657-0296-4858-b190-621831943816","name":"country","value":"={{ $json.country }}","type":"string"},{"id":"22ce107c-30ef-4abe-9fab-8d49482da87c","name":"Number","value":"={{ $json.organization.primary_phone && $json.organization.primary_phone.sanitized_number && $json.organization.primary_phone.sanitized_number ? $json.organization.primary_phone.sanitized_number : null }}","type":"string"},{"id":"302b9529-e16b-49ce-bbb6-ae2de90fed93","name":"websiteURL","value":"={{ $json.organization_website_url || $json.organization_linkedin_url}}","type":"string"},{"id":"fcb892b3-0905-4d81-8372-d94aa4877ecc","name":"Industry_keywords","value":"={{ $json.keywords }}","type":"string"},{"id":"d391b3be-c68e-449e-83e8-be5ccb8c029d","name":"annual_revenue","value":"={{ $json.organization_annual_revenue }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[7840,7856],"id":"d64379d2-b13f-46e9-8822-8fd17b317204","name":"Extract Info1"},{"parameters":{"operation":"update","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"opportunity_insights","mode":"list","cachedResultName":"opportunity_insights"},"columns":{"mappingMode":"defineBelow","value":{"processed":true,"processed_at":"={{ new Date().toISOString() }}","insight_id":"={{ $('Fetch New Opportunities').item.json.insight_id }}"},"matchingColumns":["insight_id"],"schema":[{"id":"insight_id","displayName":"insight_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"article_source","displayName":"article_source","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"identified_opportunity","displayName":"identified_opportunity","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"company_name","displayName":"company_name","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"location","displayName":"location","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"project_details_scope","displayName":"project_details_scope","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"remarks_recommended_action","displayName":"remarks_recommended_action","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"processed","displayName":"processed","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true},{"id":"processed_at","displayName":"processed_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"id":"6617bb15-4641-464b-82b7-274bccb85674","name":"Mark Insight Processed","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[8848,7888],"retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"schema":"public","table":"leads_master","columns":{"mappingMode":"defineBelow","value":{"full_name":"={{ $('Extract Info1').item.json.fullName }}","email":"={{ $('Extract Info1').item.json.emailAddress }}","linkedin_url":"={{ $('Extract Info1').item.json.linkedInURL }}","location":"={{ $('Extract Info1').item.json.location }}","created_at":"={{ new Date().toISOString() }}","updated_at":"={{ new Date().toISOString() }}","job_title":"={{ $('Extract Info1').item.json.jobTitle }}","seniority":"={{ $('Extract Info1').item.json['seniority '] }}","comapany_name":"={{ $('Code7').item.json.company_name }}","mobile":"={{ $('Extract Info1').item.json.Number }}","company_id":"={{ $json.research_id }}"},"matchingColumns":[],"schema":[{"id":"lead_id","displayName":"lead_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"company_id","displayName":"company_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"full_name","displayName":"full_name","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"email","displayName":"email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"linkedin_url","displayName":"linkedin_url","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"job_title","displayName":"job_title","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"location","displayName":"location","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"lead_type","displayName":"lead_type","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"updated_at","displayName":"updated_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"seniority","displayName":"seniority","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"comapany_name","displayName":"comapany_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"mobile","displayName":"mobile","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"id":"534cb306-62ea-49ad-b80d-f8bc141af680","name":"Insert Leads to Master","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[8448,7856],"retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"confidence","leftValue":"={{ $json.should_proceed }}","rightValue":true,"operator":{"type":"boolean","operation":"equal"}},{"id":"87dcdc0c-0380-499f-9f7c-cfe723b38d61","leftValue":"={{ $('Code8').item.json.confidence }}","rightValue":"true","operator":{"type":"string","operation":"equals"}}],"combinator":"or"},"looseTypeValidation":true,"options":{}},"id":"95327db9-2705-4447-8d56-4f35d00eadac","name":"Filter High-Confidence Insights","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[4896,7904]},{"parameters":{"schema":"public","table":"validation_log","columns":{"mappingMode":"defineBelow","value":{"confidence":"={{ $json.confidence }}","sources":"={{ $json.sources }}","snippet":"={{ $json.snippet }}","logged_at":"={{ new Date().toISOString() }}","insight_id":"={{ $('Validate Required Fields').item.json.insight_id }}","insights_summary":"={{ $json.insights_summary }}","project_status":"={{ $json.project_status }}"},"matchingColumns":[],"schema":[{"id":"log_id","displayName":"log_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"confidence","displayName":"confidence","required":true,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true},{"id":"sources","displayName":"sources","required":false,"defaultMatch":false,"display":true,"type":"array","canBeUsedToMatch":true},{"id":"snippet","displayName":"snippet","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"logged_at","displayName":"logged_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"insight_id","displayName":"insight_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"insights_summary","displayName":"insights_summary","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"project_status","displayName":"project_status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"id":"a80c8442-50f0-4009-a5c9-cf1e1b3f9845","name":"Log Validation Results","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[4688,7904],"retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"functionCode":"const validInsights = [];\n\nfor (const item of $input.all()) {\n  const insight = item.json;\n  \n  if (insight.company_name && insight.location && insight.identified_opportunity) {\n\n    insight.company_name = insight.company_name.trim();\n    insight.location = insight.location.trim();\n    insight.identified_opportunity = insight.identified_opportunity.trim();\n    \n    insight.project_keywords = extractKeywords(insight.project_details_scope || '');\n    \n    validInsights.push(insight);\n  }\n}\n\nfunction extractKeywords(text) {\n  const keywords = text.toLowerCase()\n    .match(/\\b(plant|facility|expansion|project|construction|development|upgrade|modernization|hydrogen|ammonia|production|manufacturing)\\b/g) || [];\n  return [...new Set(keywords)];\n}\n\nreturn validInsights.map(insight => ({ json: insight }));"},"id":"03fa131d-6ca2-4d58-bfed-5897438f3efe","name":"Validate Required Fields","type":"n8n-nodes-base.function","typeVersion":1,"position":[3328,7904]},{"parameters":{"operation":"executeQuery","query":"SELECT * FROM opportunity_insights WHERE processed = false OR processed IS NULL ORDER BY created_at DESC LIMIT 50","options":{}},"id":"c9797c64-4ca9-41b0-a04d-21fdbc52fd40","name":"Fetch New Opportunities","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[3120,7904],"retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"triggerTimes":{"item":[{}]}},"id":"dda42f96-dcef-456f-b832-6164eedecffa","name":"Daily Trigger","type":"n8n-nodes-base.cron","typeVersion":1,"position":[2896,7904]},{"parameters":{"fieldToSplitOut":"insight_id, article_source, identified_opportunity, company_name,  location,   project_details_scope,    remarks_recommended_action,     created_at,    processed,  processed_at","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[3536,7904],"id":"076526c1-36c9-4f94-bdcf-78d48d739e08","name":"Split Out2"},{"parameters":{"schema":"public","table":"company_research","columns":{"mappingMode":"defineBelow","value":{"company_name":"={{ $('Code7').item.json.company_name }}","company_overview":"={{ $('Code7').item.json.company_overview }}","recent_announcement":"={{ $('Code7').item.json.recent_announcement }}","pain_point_tag":"={{ $('Code7').item.json.pain_point_tag }}","tech_stack":"={{ $('Code7').item.json.tech_stack }}","business_size":"={{ $('Code7').item.json.business_size }}","competitor_association":"={{ $('Code7').item.json.competitor_association }}","news_mentions":"={{ $('Code7').item.json.news_mentions }}","project_stage":"={{ $('Code8').item.json.project_status }}","insights_summary":"={{ $('Code8').item.json.insights_summary }}","enriched_at":"={{ new Date().toISOString() }}"},"matchingColumns":[],"schema":[{"id":"research_id","displayName":"research_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"company_name","displayName":"company_name","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"company_overview","displayName":"company_overview","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"recent_announcement","displayName":"recent_announcement","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"pain_point_tag","displayName":"pain_point_tag","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"tech_stack","displayName":"tech_stack","required":false,"defaultMatch":false,"display":true,"type":"array","canBeUsedToMatch":true},{"id":"business_size","displayName":"business_size","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"competitor_association","displayName":"competitor_association","required":false,"defaultMatch":false,"display":true,"type":"array","canBeUsedToMatch":true},{"id":"news_mentions","displayName":"news_mentions","required":false,"defaultMatch":false,"display":true,"type":"array","canBeUsedToMatch":true},{"id":"project_stage","displayName":"project_stage","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"insights_summary","displayName":"insights_summary","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"enriched_at","displayName":"enriched_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"websiteURL","displayName":"websiteURL","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"annual_revenue","displayName":"annual_revenue","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Industry_keywords","displayName":"Industry_keywords","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"id":"c2b47f55-1ad1-49f1-9fff-6bf8bc76eda3","name":"Insert Company Research1","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[8144,7856],"retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"errorMessage":"Stopped: You have reached your daily limit of 50 runs."},"type":"n8n-nodes-base.stopAndError","typeVersion":1,"position":[7552,8032],"id":"f8fde853-612f-40d1-8fb6-bf4d163b2d2a","name":"Stop and Error"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[3792,7888],"id":"4c596a06-35d5-4a69-8d67-8aa7f7899c1a","name":"Loop Over Items6"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"1971880d-1d72-44c1-81fc-63fa8e62afcd","leftValue":"={{ $json.name }}","rightValue":"={{ $('Code7').item.json.company_name }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[6336,7888],"id":"c8f93d91-c67f-4b08-95fc-2c020b563f76","name":"If8"},{"parameters":{"jsCode":"const organizationId = $input.first().json.id; // Replace \"name\" if your input field is different\n\nif (!organizationId) {\n  throw new Error(\"Missing organizationId input\");\n}\n\n// Base URL\nconst baseUrl = \"https://app.apollo.io/#/people\";\n\n// Hardcoded query parameters\nconst query = [\n  \"page=1\",\n  \"sortAscending=false\",\n  \"sortByField=recommendations_score\",\n  ...[\n    \"owner\", \"founder\", \"partner\", \"head\", \"vp\", \"c_suite\", \"director\"\n  ].map(val => `personSeniorities[]=${encodeURIComponent(val)}`),\n  ...[\n    \"India\", \"United States\", \"Australia\"\n  ].map(loc => `personLocations[]=${encodeURIComponent(loc)}`),\n  \"contactEmailStatusV2[]=verified\",\n  `organizationIds[]=${encodeURIComponent(organizationId)}`\n];\n\n// Combine everything\nconst fullUrl = `${baseUrl}?${query.join(\"&\")}`;\n\nreturn [\n  {\n    json: {\n      organizationId,\n      url: fullUrl\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[6640,7872],"id":"e3e7e8ec-c319-489c-8811-4919f8c7b27b","name":"Code5"},{"parameters":{"jsCode":"const results = [];\n\nfor (const item of $input.all()) {\n  try {\n    let content = item.json.choices?.[0]?.message?.content;\n\n    if (!content) {\n      throw new Error(\"Missing content field from LLM\");\n    }\n\n    // Remove markdown-style code block wrappers (```json ... ```)\n    content = content.replace(/^```json/, '').replace(/```$/, '').trim();\n\n    // Extract only the first complete JSON block between first \"{\" and last \"}\"\n    const firstCurly = content.indexOf('{');\n    const lastCurly = content.lastIndexOf('}');\n    if (firstCurly === -1 || lastCurly === -1 || lastCurly <= firstCurly) {\n      throw new Error(\"Could not locate a valid JSON object in the string\");\n    }\n\n    const jsonString = content.substring(firstCurly, lastCurly + 1);\n\n    // Parse clean JSON string\n    const parsed = JSON.parse(jsonString);\n\n    results.push({ json: parsed });\n\n  } catch (error) {\n    results.push({\n      json: {\n        error: error.message,\n        originalInput: item.json\n      }\n    });\n  }\n}\n\nreturn results;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[5552,7888],"id":"ec5abfd6-090a-4a03-a135-826cc7015de0","name":"Code7"},{"parameters":{"jsCode":"const results = [];\n\nfor (const item of $input.all()) {\n  try {\n    // Get the content field (string containing JSON)\n    let content = item.json.choices[0].message.content\n    if (!content) throw new Error('No content field found');\n\n    // Remove triple backticks and \"json\" if present\n    content = content.replace(/```json|```/g, '').trim();\n\n    // Parse the JSON string\n    const parsed = JSON.parse(content);\n\n    results.push({ json: parsed });\n  } catch (error) {\n    results.push({\n      json: {\n        error: error.message,\n        original: item.json\n      }\n    });\n  }\n}\n\nreturn results;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[4480,7904],"id":"4ccf12c6-a51e-494f-a715-351dbbb59b8a","name":"Code8"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"91100b85-5ab1-466b-b232-287b5121f155","leftValue":"={{ $json.statusMessage }}","rightValue":"=üöÄ Success! Apollo Prospects","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[7216,7872],"id":"3e6f5fab-dbe1-46e4-b7e2-cf346a5507ca","name":"If10"},{"parameters":{"content":"## AYUSH","height":544,"width":6464,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2736,7632],"id":"02275e44-2ce4-430e-a072-ac638ab1f2fc","name":"Sticky Note5"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-4032,8288],"id":"54efd92c-ce22-419b-afef-867da929647b","name":"When chat message received","webhookId":"70d63d83-9a4a-42ce-9ca9-42111747e5f5"},{"parameters":{"options":{"systemMessage":"=You are a business development assistant for Shiva Engineering Services (SES). You are given rows of project data from a PostgreSQL (Supabase) table.\n\nYour task is to filter and return a list of *potential projects* for SES to target.\n\n**Definition of a potential project:**\n- The \"Contractor\" column is empty for that project .\n- The \"Latest Update\" column does NOT contain phrases like:\n  - \"bagged a contract\"\n  - \"project is in progress\"\n  - \"bids were invited\"\n  - \"waiting for approvals\"\n  - or anything that suggests the project is already assigned or underway.\n\n**Output requirement:**\n- Return an array of JSON objects.\n- Each object should include:\n  - `Project_ID`\n  - All available details from the row (e.g. Project annoucement date , Latest Update , Industry , Ownership , Location, Estimated Cost, etc.).\n- Sort by the most recently updated projects first ; else sort by most potential ones ).\n\nOnly return projects that truly match the criteria. If unsure, exclude the row.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-3760,8288],"id":"56bfbf41-5da1-404e-9297-d23d0e7eb671","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-3856,8528],"id":"44ff6d04-9942-4116-a2f4-e915ecffcd7a","name":"OpenAI Chat Model"},{"parameters":{"operation":"select","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"Project","mode":"list","cachedResultName":"Project"},"returnAll":true,"options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[-3456,8512],"id":"778aca00-518b-40b8-a9de-5fe5fa1c1089","name":"Select rows from a table in Postgres"},{"parameters":{"modelId":{"__rl":true,"value":"chatgpt-4o-latest","mode":"list","cachedResultName":"CHATGPT-4O-LATEST"},"messages":{"values":[{"content":"=You are part of the cold email team for SES , which is an AI Automation Agency offering process automation, marketing automation and automation consulting to businesses around the world. \n\nYour job is to create 3 emails given the following info about a new cold lead: \n\n1. Research: Findings about the prospect by researching them on social media and the web. \n2. Analysis: Insights extracted from analysing the research. \n3. Tactic: Strategy to create the cold emails. \n\nYour job is to create a cold email sequence of 2 emails for the purpose of A/B testing. The tactic for each email should closely follow the instructions below, whilst the content of each email must follow the research and analysis. \n\n\n# Tactic: \n\n1. Email#1: \n\n1.1 Recepient \n    \"To\" field - Contact Person Email , if available .\n\n    \n\n1.2 Subject line: \n\nThe email subject line should : \n- Be maximum 4-6 words \n- Include the prospects name or company name (choose based on context) when possible without sounding unnatural \n- Never include spam trigger words like ‚Äúfree,‚Äù ‚Äúguarantee,‚Äù ‚Äúno obligation,‚Äù \"price,\" \"100%\" \"sale,\" and excessive punctuation, which can trigger spam filters. \n- Create curiousity without sounding spammy or like we're selling them anything \n\n\n1.3 Body\n\nStructure: The email must follow this structure closely:\na) Hook: The first 2 or 3 sentences of the email is a hook. The hook should be the personalization part of the email, capturing the prospects attention so they don't scroll. \nb) Pain point: After the hook, you must outline a pain point that was analysed about the prospect. This shouldn't sound salesy, but should be directly related to their business. The goal is to capture the readers attention, not sell them a solution. \nc) CTA: Say you've been working on solving that problem and would love to share your insights over a quick 15 minute call on {{ ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'][(new Date().getDay() + 2) % 7] }}. Have a clear next step for them (for example \"Should I book you in?).\n\nGuidelines -  The email body should:\n\n- Be short (maximum 100 words).\n- Have short paragraphs (1 or 2 sentences in each) to include white space. \n- Use a conversational tone to keep the email casual. \n- Be \"You\" focused, incorporating \"you\" as much as possible.\n- Be in 6th-grade reading level with simple language. \n- Avoid images, attachments, videos, custom code, spammy words above, bullet points, punctuation.\n- Not have absurd claims (it should be believable).\n- Should always start with \"Hey ,\"\n- Should be concise. \n- Never start with formal openers like \"Hope you're doing well\" (Get right into the email every time).\n- Be nice and inviting.\n- End with \"Kind regards, Khushi \"\n\n\n2. Email#2: \nThis email will be the alternative email ( Subject and body framed in a different way ) as email#1 and is considered to be avaluated by manager via A/B testing that which email fits the best in context .  \n \n\n# Rules - Other things to consider: \n- Your goal is to create an engaging email that will get us a reply. Choose the best pain points and personalization opportunities from the analysis to achieve this objective. \n- You must closely follow the guidelines provided for each email. \n- Never come across condescending or rude when mentioning the pain point. \n- When using the personalization opportunities from the analysis, always mention where the info was found - usually  \"Online\" or \"LinkedIn\" (look at Supporting Evidence for this).\n\n# Output format\nYour output must follow this JSON format: \n\n{ \n  \"to\": \"Contact Person Email \" , \n  \"email1\": {\n    \"subject\": \"TEXT-HERE\",\n    \"body\": \"HTML-HERE\"\n  },\n  \"email2\": {\n     \"subject\": \"TEXT-HERE\",\n     \"body\": \"HTML-HERE\"\n  },\n\n}\n\n- Don't wrap the output in ```json```. \n- Don't output anything else. \n- Don't use HTML code , use only next line character ( \"\\n\") for line breaks and nothing else.\n\n# Task: New prospect\nThere's a new prospect. Create the emails by considering the following details: \n\n1. Analysis: \n{{ $json.message.content }} \n"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-2576,8304],"id":"8d8f3c9f-053c-4d5f-9d15-d64b1a0ebfba","name":"Email #1 #2 #3"},{"parameters":{"mode":"raw","jsonOutput":"=  {{ $json.message.content.replaceAll('```json','').replaceAll('```','') }}\n\n\n","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2208,8304],"id":"5378671b-d248-4702-a433-4a3e7c8b9cd0","name":"Emails","onError":"continueRegularOutput"},{"parameters":{"jsCode":"// Loop over each item passed from the Merge node\nfor (const item of items) {\n\t// Get the country value (make sure to match the field name exactly)\n\tconst countryRaw = item.json[\"Country \"];\n\tlet country = \"\";\n\tif (countryRaw) {\n\t\tcountry = countryRaw.toLowerCase().trim();\n\t}\n\n\t// Define arrays for the different time zone groups\n\tconst t1Countries = [\"usa\", \"united states\", \"canada\"];\n\tconst europeanCountries = [\n\t\t\"albania\", \"andorra\", \"armenia\", \"austria\", \"azerbaijan\", \"belarus\", \"belgium\",\n\t\t\"bosnia and herzegovina\", \"bulgaria\", \"croatia\", \"cyprus\", \"czech republic\", \"czechia\",\n\t\t\"denmark\", \"estonia\", \"finland\", \"france\", \"georgia\", \"germany\", \"greece\", \"hungary\",\n\t\t\"iceland\", \"ireland\", \"italy\", \"kosovo\", \"latvia\", \"liechtenstein\", \"lithuania\",\n\t\t\"luxembourg\", \"malta\", \"moldova\", \"monaco\", \"montenegro\", \"netherlands\", \"north macedonia\",\n\t\t\"norway\", \"poland\", \"portugal\", \"romania\", \"russia\", \"san marino\", \"serbia\", \"slovakia\",\n\t\t\"slovenia\", \"spain\", \"sweden\", \"switzerland\", \"turkey\", \"ukraine\", \"united kingdom\",\n\t\t\"vatican city\"\n\t];\n\tconst t3Countries = [\"australia\", \"new zealand\"];\n\n\t// Determine and populate the Time Zone based on the country value\n\tif (t1Countries.includes(country)) {\n\t\titem.json[\"Time Zone\"] = \"T1\";\n\t} else if (europeanCountries.includes(country)) {\n\t\titem.json[\"Time Zone\"] = \"T2\";\n\t} else if (t3Countries.includes(country)) {\n\t\titem.json[\"Time Zone\"] = \"T3\";\n\t} else {\n\t\t// For any other country not defined above, assign T4.\n\t\t// If you want to limit to T1, T2, or T3 only, you can decide to leave it blank or assign a default value.\n\t\titem.json[\"Time Zone\"] = \"T4\";\n\t}\n}\n\nreturn items;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2048,8304],"id":"21ecdd1e-db36-4a43-845d-40fb7379d9c0","name":"Time Zone"},{"parameters":{"jsCode":"// Array of sender emails to rotate through\nconst senderEmails = [\n  \"marketing@shiva-engineering.com\",\n  \"marketing@shiva-engineering.com\",\n  \"marketing@shiva-engineering.com\"\n];\n\n// Get all input items from the Time Zone node\nconst items = $input.all();\n\n// Process each item\nfor (let i = 0; i < items.length; i++) {\n  // Calculate which email to use based on position (cycling through the array)\n  const emailIndex = i % senderEmails.length;\n  \n  // Assign the sender email to the current item\n  items[i].json[\"Sender Email\"] = senderEmails[emailIndex];\n}\n\n// Return the updated items\nreturn items;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1888,8304],"id":"81dbcead-1842-4f88-9715-50c07673ef36","name":"Sender Email"},{"parameters":{"jsCode":"// Function to generate a random 6-digit number\nfunction generateRandomToken() {\n  return Math.floor(100000 + Math.random() * 900000);\n}\n\n// Process each item from the Sender Email node\nfor (let i = 0; i < items.length; i++) {\n  // Add the token parameter to each item\n  items[i].json.token = generateRandomToken();\n}\n\n// Return the modified items\nreturn items;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1712,8304],"id":"fa70f01b-08da-45b2-9ebc-f71b42e311be","name":"Opt Out Token"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.sender_email }}","rightValue":"marketing@shiva-engineering.com","operator":{"type":"string","operation":"equals"},"id":"b895fd00-6f66-41d1-ab55-b1337e744a7f"}],"combinator":"and"},"renameOutput":true,"outputKey":"kgd"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b90ae81e-e015-4138-955b-f8efae253fba","leftValue":"={{ $json.sender_email }}","rightValue":"kykhushi0703@gmail.com","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"k"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"93b60147-610f-4c3c-adf6-a7f8b2159096","leftValue":"={{ $json.sender_email }}","rightValue":"youremail@gmail.com","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"h"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-2880,6272],"id":"6a907b9f-9b01-4275-adfa-13f8a35c32e4","name":"Switch"},{"parameters":{"amount":15},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-2112,6800],"id":"bf956796-7ec4-4477-a032-35e645ad3cf4","name":"Wait1","webhookId":"c4cf719a-d47f-4761-8a16-aff92b8e9a19"},{"parameters":{"rule":{"interval":[{"field":"cronExpression","expression":"0 11 * * Mon"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-3856,6752],"id":"9047da3f-c063-4cd9-a2ef-1c54fdc3c1db","name":"Schedule Trigger1","disabled":true},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.sender_email }}","rightValue":"marketing@shiva-engineering.com","operator":{"type":"string","operation":"equals"},"id":"b895fd00-6f66-41d1-ab55-b1337e744a7f"}],"combinator":"and"},"renameOutput":true,"outputKey":"kgd"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b90ae81e-e015-4138-955b-f8efae253fba","leftValue":"={{ $json.sender_email }}","rightValue":"kykhushi0703@gmail.com","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"k"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"93b60147-610f-4c3c-adf6-a7f8b2159096","leftValue":"={{ $json.sender_email }}","rightValue":"youremail@gmail.com","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"h"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-2784,5120],"id":"8edf6acc-7d2d-4e4e-ba14-0c53c44e8940","name":"Switch1"},{"parameters":{"assignments":{"assignments":[{"id":"2d1b89f0-661b-4b21-9bb2-cb8419b22035","name":"replied","value":"={{ Object.keys($json).length > 0 ? \"Yes\" : \"No\" }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1968,5104],"id":"2b04b0db-5a52-4f62-a9d0-a58e87cdc384","name":"Edit Fields1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"177601be-b2c3-45cc-8e15-cd064fbaf578","leftValue":"={{ $json.replied }}","rightValue":"Yes","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1664,5040],"id":"3937d973-0843-44c2-9fd0-a868c8f4d7b8","name":"If1"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[-1872,4912],"id":"f176ba65-e44e-4988-9e66-08689167d5ba","name":"Merge1"},{"parameters":{"operation":"appendOrUpdate","documentId":{"__rl":true,"value":"1pY5nJihyUUObA1LpbhdgANq0DSX7A9TLOTWlEr9PMBk","mode":"list","cachedResultName":"Research","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1pY5nJihyUUObA1LpbhdgANq0DSX7A9TLOTWlEr9PMBk/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1pY5nJihyUUObA1LpbhdgANq0DSX7A9TLOTWlEr9PMBk/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"LinkedIn URL":"={{ $json[\"LinkedIn URL\"] }}","Replied":"Yes"},"matchingColumns":["LinkedIn URL"],"schema":[{"id":"First Name","displayName":"First Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Last Name","displayName":"Last Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email Address","displayName":"Email Address","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Phone Number","displayName":"Phone Number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Country ","displayName":"Country ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Location","displayName":"Location","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Industry","displayName":"Industry","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Company Name","displayName":"Company Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Job Title","displayName":"Job Title","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Seniority","displayName":"Seniority","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Website URL","displayName":"Website URL","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"LinkedIn URL","displayName":"LinkedIn URL","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Analysed","displayName":"Analysed","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Research Report","displayName":"Research Report","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#1 Body","displayName":"Email#1 Body","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#1 Subject","displayName":"Email#1 Subject","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email #2 Body","displayName":"Email #2 Body","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#3 Body","displayName":"Email#3 Body","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#3 Subject","displayName":"Email#3 Subject","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Sender Email","displayName":"Sender Email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Time Zone","displayName":"Time Zone","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#1 Sent","displayName":"Email#1 Sent","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#2 Sent","displayName":"Email#2 Sent","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#3 Sent","displayName":"Email#3 Sent","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Message ID","displayName":"Message ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Replied","displayName":"Replied","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Token","displayName":"Token","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Opted Out","displayName":"Opted Out","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[-1440,5136],"id":"be5a4d9c-2fc7-4d0e-857e-492be4487d87","name":"Replied = Yes1"},{"parameters":{"method":"POST","url":"https://www.googleapis.com/gmail/v1/users/me/messages/send","authentication":"predefinedCredentialType","nodeCredentialType":"gmailOAuth2","sendBody":true,"bodyParameters":{"parameters":[{"name":"raw","value":"={{ $json.raw }}"},{"name":"=threadId","value":"={{ $json.threadId }}"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1248,4960],"id":"abb93b56-a3b1-4cc7-8c69-776212f87919","name":"HTTP Request3"},{"parameters":{"assignments":{"assignments":[{"id":"2d1b89f0-661b-4b21-9bb2-cb8419b22035","name":"replied","value":"={{ Object.keys($json).length > 0 ? \"Yes\" : \"No\" }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1888,4400],"id":"76868928-a275-4d93-bee6-b66046f0d66f","name":"Edit Fields2"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[-1680,4336],"id":"918b066f-3c9a-45ea-9266-2834b79dd79e","name":"Merge2"},{"parameters":{"operation":"appendOrUpdate","documentId":{"__rl":true,"value":"1pY5nJihyUUObA1LpbhdgANq0DSX7A9TLOTWlEr9PMBk","mode":"list","cachedResultName":"Research","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1pY5nJihyUUObA1LpbhdgANq0DSX7A9TLOTWlEr9PMBk/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1pY5nJihyUUObA1LpbhdgANq0DSX7A9TLOTWlEr9PMBk/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"LinkedIn URL":"={{ $json[\"LinkedIn URL\"] }}","Replied":"Yes"},"matchingColumns":["LinkedIn URL"],"schema":[{"id":"First Name","displayName":"First Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Last Name","displayName":"Last Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email Address","displayName":"Email Address","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Phone Number","displayName":"Phone Number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Country ","displayName":"Country ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Location","displayName":"Location","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Industry","displayName":"Industry","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Company Name","displayName":"Company Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Job Title","displayName":"Job Title","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Seniority","displayName":"Seniority","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Website URL","displayName":"Website URL","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"LinkedIn URL","displayName":"LinkedIn URL","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Analysed","displayName":"Analysed","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Research Report","displayName":"Research Report","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#1 Body","displayName":"Email#1 Body","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#1 Subject","displayName":"Email#1 Subject","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email #2 Body","displayName":"Email #2 Body","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#3 Body","displayName":"Email#3 Body","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#3 Subject","displayName":"Email#3 Subject","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Sender Email","displayName":"Sender Email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Time Zone","displayName":"Time Zone","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#1 Sent","displayName":"Email#1 Sent","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#2 Sent","displayName":"Email#2 Sent","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#3 Sent","displayName":"Email#3 Sent","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Message ID","displayName":"Message ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Replied","displayName":"Replied","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Token","displayName":"Token","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Opted Out","displayName":"Opted Out","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[-1232,4432],"id":"4cbc22cf-9022-49e7-85bd-1a0c741f472f","name":"Replied = Yes2"},{"parameters":{"method":"POST","url":"https://www.googleapis.com/gmail/v1/users/me/messages/send","authentication":"predefinedCredentialType","nodeCredentialType":"gmailOAuth2","sendBody":true,"bodyParameters":{"parameters":[{"name":"raw","value":"={{ $json.raw }}"},{"name":"=threadId","value":"={{ $json.threadId }}"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1008,4240],"id":"43533bbb-30ca-4e2d-9f3e-0e608076fc58","name":"HTTP Request4"},{"parameters":{"assignments":{"assignments":[{"id":"2d1b89f0-661b-4b21-9bb2-cb8419b22035","name":"replied","value":"={{ Object.keys($json).length > 0 ? \"Yes\" : \"No\" }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1968,5760],"id":"e3d2a79b-6e44-4889-8e52-04730df0e4fc","name":"Edit Fields3"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[-1872,5568],"id":"500e81cb-38fa-4850-b8ae-42822753022c","name":"Merge3"},{"parameters":{"operation":"appendOrUpdate","documentId":{"__rl":true,"value":"1pY5nJihyUUObA1LpbhdgANq0DSX7A9TLOTWlEr9PMBk","mode":"list","cachedResultName":"Research","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1pY5nJihyUUObA1LpbhdgANq0DSX7A9TLOTWlEr9PMBk/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1pY5nJihyUUObA1LpbhdgANq0DSX7A9TLOTWlEr9PMBk/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"LinkedIn URL":"={{ $json[\"LinkedIn URL\"] }}","Replied":"Yes"},"matchingColumns":["LinkedIn URL"],"schema":[{"id":"First Name","displayName":"First Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Last Name","displayName":"Last Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email Address","displayName":"Email Address","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Phone Number","displayName":"Phone Number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Country ","displayName":"Country ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Location","displayName":"Location","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Industry","displayName":"Industry","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Company Name","displayName":"Company Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Job Title","displayName":"Job Title","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Seniority","displayName":"Seniority","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Website URL","displayName":"Website URL","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"LinkedIn URL","displayName":"LinkedIn URL","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Analysed","displayName":"Analysed","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Research Report","displayName":"Research Report","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#1 Body","displayName":"Email#1 Body","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#1 Subject","displayName":"Email#1 Subject","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email #2 Body","displayName":"Email #2 Body","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#3 Body","displayName":"Email#3 Body","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#3 Subject","displayName":"Email#3 Subject","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Sender Email","displayName":"Sender Email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Time Zone","displayName":"Time Zone","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#1 Sent","displayName":"Email#1 Sent","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#2 Sent","displayName":"Email#2 Sent","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#3 Sent","displayName":"Email#3 Sent","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Message ID","displayName":"Message ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Replied","displayName":"Replied","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Token","displayName":"Token","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Opted Out","displayName":"Opted Out","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[-1440,5824],"id":"813ef333-3d0c-4705-92e9-8a7a2c863c06","name":"Replied = Yes3"},{"parameters":{"jsCode":"// JavaScript code for n8n Code node to prepare HTML email for Gmail API\nconst emailData = {\n  messageId: $input.item.json['Message ID'],\n  threadId: $input.item.json['Thread ID'] || $input.item.json['Message ID'],\n  subject: $input.item.json['Email#1 Subject'],\n  senderEmail: $input.item.json['Sender Email'],\n  recipientEmail: $input.item.json['Email Address'],\n  token: $input.item.json['Token']\n};\n\n// Check available input keys to help diagnose the issue\nconst inputKeys = Object.keys($input.item.json);\nconsole.log('Available input keys:', inputKeys);\n\n// Try to find the email body in different possible formats\nlet emailBodyContent = '';\n// First try the exact key name\nif ($input.item.json['Email#2 Body'] !== undefined) {\n  emailBodyContent = $input.item.json['Email#2 Body'];\n} \n// Try with a space after the hash\nelse if ($input.item.json['Email #2 Body'] !== undefined) {\n  emailBodyContent = $input.item.json['Email #2 Body'];\n} \n// Try other possible variations\nelse if ($input.item.json['EmailBody'] !== undefined) {\n  emailBodyContent = $input.item.json['EmailBody'];\n} \n// Default fallback message if none found\nelse {\n  emailBodyContent = \"Thank you for your attention to this matter.\";\n  console.log(\"No email body found, using default text\");\n}\n\n// Ensure message ID is properly formatted\nconst formattedMessageId = emailData.messageId.startsWith('<') ? \n  emailData.messageId : \n  `<${emailData.messageId}>`;\n\n// Create HTML email body with unsubscribe link\nconst htmlBody = `${emailBodyContent}<br><br>\n<a href=\"https://kiaghasem.app.n8n.cloud/webhook/unsubscribe?tkn=${emailData.token}\">Click Here to Unsubscribe</a>`;\n\n// Create email in RFC 2822 format with HTML content type\nconst emailContent = \n  `In-Reply-To: ${formattedMessageId}\\n` +\n  `References: ${formattedMessageId}\\n` +\n  `Subject: Re: ${emailData.subject}\\n` +\n  `From: ${emailData.senderEmail}\\n` +\n  `To: ${emailData.recipientEmail}\\n` +\n  `Content-Type: text/html; charset=\"UTF-8\"\\n\\n` +\n  `${htmlBody}`;\n\n// Base64 encode and convert to base64url format\nconst base64EncodedEmail = Buffer.from(emailContent)\n  .toString('base64')\n  .replace(/\\+/g, '-')\n  .replace(/\\//g, '_')\n  .replace(/=+$/, '');\n\n// Return an object with the encoded email and thread ID\nreturn {\n  json: {\n    raw: base64EncodedEmail,\n    threadId: emailData.threadId\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1440,5568],"id":"4a9700d8-506a-4fb8-b823-630a81671e2a","name":"Code6"},{"parameters":{"resource":"draft","subject":"={{ $json.email1.subject }}","bodyContent":"={{ $json.email1.body }}","additionalFields":{"from":"={{ $json['Sender Email'] }}","isReadReceiptRequested":false,"toRecipients":"={{ $json.to }}"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-1552,8304],"id":"51532f8e-8d08-44b5-932e-2a19fcee46e3","name":"Create a draft","webhookId":"5c2ccbbb-fe33-4b32-8e83-34405dfbd681"},{"parameters":{"method":"POST","url":"https://pvckiiclgzdzwcsxtekg.supabase.co/rest/v1/email_drafts","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB2Y2tpaWNsZ3pkendjc3h0ZWtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1MjMyMTksImV4cCI6MjA2ODA5OTIxOX0.at2jET1WoXwOxjWx-ORAiu6qFsn9KW-bUMM4Tn64Qlw"},{"name":"Authorization","value":"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB2Y2tpaWNsZ3pkendjc3h0ZWtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1MjMyMTksImV4cCI6MjA2ODA5OTIxOX0.at2jET1WoXwOxjWx-ORAiu6qFsn9KW-bUMM4Tn64Qlw"},{"name":"Content-Type","value":"application/json"},{"name":"Prefer","value":"return=representation"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"subject\": \"{{$json.subject}}\",\n  \"body\": \"testing body\",\n  \"recipient\": \"{{$json.toRecipients[0].emailAddress.address}}\",\n  \"status\": \"draft\",\n  \"outlook_draft_id\": \"{{$json.id}}\",\n  \"created_by\": \"{{$json.from.emailAddress.name}}\",\n  \"sender_email\": \"{{$json.sender.emailAddress.address}}\",\n  \"message_id\": \"{{$json.internetMessageId}}\",\n  \"delivered_status\": \"pending\",\n  \"replied\": false\n}\n","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1360,8304],"id":"8619f8bd-fbe3-4a67-99e2-6689c2b6b6cb","name":"Insert to Supabase"},{"parameters":{"modelId":{"__rl":true,"value":"chatgpt-4o-latest","mode":"list","cachedResultName":"CHATGPT-4O-LATEST"},"messages":{"values":[{"content":"=You are a Project Insights Specialist helping SES Engineering identify how it can add strategic value to a given infrastructure or industrial project. Based on the fields provided, your job is to analyze the project and generate personalized insights for cold outreach that are:\n\n- Relevant to the project context\n\n- Tied directly to SES Engineering's capabilities\n\n- Helpful and technically clear\n\n- Strictly grounded in the input fields (no hallucination)\n\n## SES Engineering Summary\nSES Engineering delivers end-to-end Engineering, Procurement, and Construction (EPC) services, focused on quality, safety, sustainability, and innovation. Their team ensures seamless execution‚Äîfrom initial design to commissioning‚Äîbringing projects to life on-time and on-budget.\n\n#Core Offerings:\n- Site Master Planning (SMP): Layout optimization, space utilization, CAPEX/OPEX efficiency\n\n- Front-End Engineering Design (FEED): Early-stage risk mitigation, predictability in cost/timelines\n\n- Multi-Disciplinary Design & Lifecycle Support: Mechanical, civil, electrical, instrumentation\n\n- Procurement Strategy & Vendor Management: Supply-chain efficiency, long-lead item planning\n\n- Process Scale-Up Expertise ( Scale up Engineering): From pilot to full-scale production, throughput optimization . Helps small enterprises grow scalably . \n\n- Prefabrication & Modular Construction: Time-saving, reduced on-site congestion, parallel execution\n\n## Objective\n#Your Goal:\n Generate project-specific insights for cold outreach by:\n\n- Finding strong personalization opportunities using only the structured fields below\n\n- Identifying pain points or risks (if applicable) based on stage, cost, or complexity\n\n- Mapping how SES can help, connecting each point clearly to SES capabilities\n\n## Structured Input Fields\nThe input will contain structured fields like:\n\n1. Project Name\n\n2. Project Type\n\n3. Implementation Stage\n\n4. Construction Start & End Dates\n\n5. Cost or Estimated Cost Range\n\n6. Industry\n\n7. Ownership\n\n8. Location, State, District\n\n10. Product1 / Product2\n\n11. Promoter Name / Promoter Details\n\n12. Latest Update (may contain recent news or progress info)\n\n‚ùå Constraints\n- Never invent any roles, people, or project details not given in input\n\n- Do not generalize or assume facts‚Äîuse only what‚Äôs in the fields\n\n- If nothing meaningful is available in a field, ignore it gracefully\n\n## OUTPUT FORMAT \n\n#Personalization\n- Opportunity 1: <specific personalized insight grounded in the input>\n- Opportunity 2: <another insight‚Äîoptional if none available>\n\n#Pain Points\n- <Optional risk or challenge inferred from cost, stage, or timeline>  \n  (e.g., ‚ÄúPossible execution delays due to early-stage planning + high cost‚Äù)\n\n#How SES Can Help\nSES can support this project by <explain using SES capabilities>.\n- Given the current stage (e.g., {{ $json['Implementation Stage'] }}), SES would [insert applicable offering like FEED, SMP, scale-up help]\n- To overcome [pain point], SES applies [specific capability]\n- As the project relates to {{ $json.Industry }}   and involves {{ $json.Product1 }} , SES brings expertise in [relevant domain]\n\n#Supporting Evidence\n- Project Name: {{ $json['Project Name'] }}\n- Promoter: {{ $json['Promoter Name'] }}\n- Industry: {{ $json.Industry }}\n- Implementation Stage: {{ $json['Implementation Stage'] }}\n- Latest Update: {{ $json['Latest Update'] }}\n\n# CONTACT DETAILS\n-Contact person name : {{ $json['Promoter_Contact Person Name'] }}\n- Contact person Designation : {{ $json['Promoter_Contact Person_Designation'] }}\n- Contact person Phone Number : {{ $json['Promoter_Contact Person_Direct Contact'] }}\n-Contact person Email : {{ $json['Promoter_Contact Person_Email'] }}\n\nNOTE : If contact person information is not there , return \" no contact details provided \"\n\n# Examples of Useful Opening Lines in Output:\n\n‚ÄúSES can support this project by providing FEED services to lay a strong technical foundation before EPC begins.‚Äù\n\n‚ÄúGiven the early planning stage and complex scale, SES would apply its SMP and procurement expertise to reduce risk and cost.‚Äù\n\n‚ÄúTo address potential delays mentioned in the Latest Update, SES‚Äôs modular construction capability can accelerate timelines and minimize on-site bottlenecks.‚Äù"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-3024,8304],"id":"da8a5b3a-b1c0-417d-af77-19d40f5cf54e","name":"Analyze"},{"parameters":{"url":"https://pvckiiclgzdzwcsxtekg.supabase.co/rest/v1/email_drafts","sendQuery":true,"queryParameters":{"parameters":[{}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB2Y2tpaWNsZ3pkendjc3h0ZWtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1MjMyMTksImV4cCI6MjA2ODA5OTIxOX0.at2jET1WoXwOxjWx-ORAiu6qFsn9KW-bUMM4Tn64Qlw"},{"name":"Authorization","value":"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB2Y2tpaWNsZ3pkendjc3h0ZWtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1MjMyMTksImV4cCI6MjA2ODA5OTIxOX0.at2jET1WoXwOxjWx-ORAiu6qFsn9KW-bUMM4Tn64Qlw"},{"name":"Content-Type","value":"application/json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3600,6752],"id":"5fc1217d-7f56-4639-bdd5-26c96e53e1a9","name":"Fetch senders from Supabase","disabled":true},{"parameters":{"operation":"update","tableId":"email_drafts","filters":{"conditions":[{"keyName":"recipient","condition":"eq","keyValue":"={{ $('Switch').item.json.recipient }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"delivered_status","fieldValue":"delivered"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-848,6096],"id":"5f60fc47-f68e-4517-be7e-ebb6776bc503","name":"Update Email Status"},{"parameters":{"operation":"update","tableId":"email_drafts","filters":{"conditions":[{"keyName":"recipient","condition":"eq","keyValue":"={{ $('Switch').item.json.recipient }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"delivered_status","fieldValue":"delivered"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-2288,6560],"id":"f24d1f43-13cb-456c-a25c-c076eb93dd67","name":"Update Email Status1"},{"parameters":{"toRecipients":"={{ $json.recipient }}","subject":"={{ $json.subject }}","bodyContent":"={{ $json.body }}","additionalFields":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-2320,6752],"id":"5ea2015d-7644-49ab-a96b-d4c9e77deb12","name":"Send a message1","webhookId":"d3b8722f-192d-4640-b73d-f928e874ca07"},{"parameters":{"operation":"update","tableId":"email_drafts","filters":{"conditions":[{"keyName":"recipient","condition":"eq","keyValue":"={{ $('Switch').item.json.recipient }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"delivered_status","fieldValue":"delivered"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-2320,7104],"id":"f679413f-b555-43b4-be0d-5b9d3da92cdc","name":"Update Email Status2"},{"parameters":{"toRecipients":"={{ $json.recipient }}","subject":"={{ $json.subject }}","bodyContent":"={{ $json.body }}","additionalFields":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-2320,7280],"id":"29da24b6-4e5d-4f26-b95c-37c8f7dfee1f","name":"Send a message2","webhookId":"d3b8722f-192d-4640-b73d-f928e874ca07"},{"parameters":{"content":"## BD MANAGER DASHBOARD APPROVALS VALA","height":320,"width":528},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-3888,6640],"id":"7caea6fe-cdb8-4deb-9374-2c16c7627a1d","name":"Sticky Note7"},{"parameters":{"operation":"getAll","limit":500,"filtersUI":{"values":{"filters":{"foldersToInclude":[]}}},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-2112,4416],"id":"68dde50c-f1bc-42f6-b630-88d98d8cb624","name":"Get many messages","webhookId":"374af418-78cb-4975-88c8-1a3997c387ec"},{"parameters":{"resource":"folder","operation":"get","folderId":{"__rl":true,"value":"AAMkADQ4ODUzZmIwLTBhZDMtNGU4Zi1iZGU2LWQzOGNjZDE2MDIyNQAuAAAAAAAqsVm2OXCsQKlnQI0U0DkHAQC9N3ccsoV-RrGfhK8JJhnVAAAAAAEMAAA=","mode":"list","cachedResultName":"Inbox","cachedResultUrl":"https://outlook.office365.com/mail/AAMkADQ4ODUzZmIwLTBhZDMtNGU4Zi1iZGU2LWQzOGNjZDE2MDIyNQAuAAAAAAAqsVm2OXCsQKlnQI0U0DkHAQC9N3ccsoV%2FRrGfhK8JJhnVAAAAAAEMAAA%3D"},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-2320,4496],"id":"6d5d80aa-5e33-429b-a730-9bc1f120ebc5","name":"Get a folder","webhookId":"d5d04720-566b-4187-a94e-ae9b92880104"},{"parameters":{"resource":"folder","operation":"get","folderId":{"__rl":true,"value":"AAMkADQ4ODUzZmIwLTBhZDMtNGU4Zi1iZGU2LWQzOGNjZDE2MDIyNQAuAAAAAAAqsVm2OXCsQKlnQI0U0DkHAQC9N3ccsoV-RrGfhK8JJhnVAAAAAAEMAAA=","mode":"list","cachedResultName":"Inbox","cachedResultUrl":"https://outlook.office365.com/mail/AAMkADQ4ODUzZmIwLTBhZDMtNGU4Zi1iZGU2LWQzOGNjZDE2MDIyNQAuAAAAAAAqsVm2OXCsQKlnQI0U0DkHAQC9N3ccsoV%2FRrGfhK8JJhnVAAAAAAEMAAA%3D"},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-2320,5264],"id":"5f8ca0c3-80a0-4b72-b7c3-6a08f7f06e89","name":"Get a folder1","webhookId":"d5d04720-566b-4187-a94e-ae9b92880104"},{"parameters":{"operation":"getAll","filtersUI":{"values":{"filters":{"foldersToInclude":[]}}},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-2176,5120],"id":"90b276b4-45c0-4c20-882e-de5a7fd89d29","name":"Get many messages1","webhookId":"374af418-78cb-4975-88c8-1a3997c387ec"},{"parameters":{"operation":"executeQuery","query":"SELECT id, recipient , sender_email\nFROM public.email_drafts\nWHERE replied IS NOT TRUE\nLIMIT 1 ;\n","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-2960,5136],"id":"f97c01a5-1b50-45a8-b4d8-d4f14d66e385","name":"Get Unreplied emails"},{"parameters":{"resource":"folder","operation":"get","folderId":{"__rl":true,"value":"AAMkADQ4ODUzZmIwLTBhZDMtNGU4Zi1iZGU2LWQzOGNjZDE2MDIyNQAuAAAAAAAqsVm2OXCsQKlnQI0U0DkHAQC9N3ccsoV-RrGfhK8JJhnVAAAAAAEMAAA=","mode":"list","cachedResultName":"Inbox","cachedResultUrl":"https://outlook.office365.com/mail/AAMkADQ4ODUzZmIwLTBhZDMtNGU4Zi1iZGU2LWQzOGNjZDE2MDIyNQAuAAAAAAAqsVm2OXCsQKlnQI0U0DkHAQC9N3ccsoV%2FRrGfhK8JJhnVAAAAAAEMAAA%3D"},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-2320,5920],"id":"d0cb0165-b126-492c-b7e0-f774aa25b811","name":"Get a folder2","webhookId":"d5d04720-566b-4187-a94e-ae9b92880104"},{"parameters":{"operation":"getAll","filtersUI":{"values":{"filters":{"foldersToInclude":[]}}},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-2144,5824],"id":"916e4527-e3f5-44ac-b142-2b50a7468fef","name":"Get many messages2","webhookId":"374af418-78cb-4975-88c8-1a3997c387ec"},{"parameters":{"assignments":{"assignments":[{"id":"71c05052-a399-42e1-a493-3085aa7f26d1","name":"subject","value":"={{ $json.subject }}","type":"string"},{"id":"14a37df6-9581-4603-a9f1-5ce8f8248a8d","name":"body_text","value":"={{ $json.body.content }}","type":"string"},{"id":"0a1b48c6-025d-4ca0-802b-67089989f7bc","name":"to_emails","value":"={{ $json.toRecipients[0].emailAddress.address }}","type":"string"},{"id":"047c2f53-6c5d-4386-bdcd-184c3af65bb7","name":"from_email","value":"={{ $json.from.emailAddress.address }}","type":"string"},{"id":"b7c6728c-61ee-44c3-bd03-2b8015ac9a75","name":"from_name","value":"={{ $json.from.emailAddress.name }}","type":"string"},{"id":"b91a5ac5-5bca-4223-ab4c-a911c8d15297","name":"id","value":"={{ $json.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1440,6240],"id":"c8739e7e-c0cf-488c-a672-9d378e2764a0","name":"Edit Fields5"},{"parameters":{"operation":"update","tableId":"email_drafts","filters":{"conditions":[{"keyName":"id","condition":"eq","keyValue":"={{ $json.id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"status","fieldValue":"sent"},{"fieldId":"delivered_status","fieldValue":"delivered"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-944,6288],"id":"2565dd0b-7f8c-4ca6-b499-8671a1748632","name":"Update a row"},{"parameters":{"url":"=https://graph.microsoft.com/v1.0/me/messages/{{ $('Loop Over Items7').item.json.outlook_draft_id }}?$select=subject,body,toRecipients,ccRecipients,bccRecipients,replyTo,sender,from&$expand=attachments\n","authentication":"genericCredentialType","genericAuthType":"oAuth2Api","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1632,6288],"id":"f9efb188-5b23-49de-b3a4-b0d89ec5242b","name":"Get Message Metadata"},{"parameters":{"operation":"getAll","tableId":"email_drafts","limit":1,"filters":{"conditions":[{"keyName":"status","condition":"eq","keyValue":"draft"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1120,8384],"id":"fb1e8296-1c7a-4a7f-8a92-ae4d899a97d9","name":"Fetch status=draft Rows"},{"parameters":{"jsCode":"items.sort((a, b) => new Date(a.json.created_at) - new Date(b.json.created_at));\nreturn [items[0]];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-880,8416],"id":"2cf1148c-668c-4912-b148-7125c86fd33b","name":"Sort in asc ( Created date )"},{"parameters":{"assignments":{"assignments":[{"id":"17da43d1-1b53-4484-ae3d-f1c8858888c7","name":"subject","value":"={{ $json.subject }}","type":"string"},{"id":"99bd63a2-c039-4fed-8dd8-cbec8d7d926c","name":"body","value":"={{ $('Create a draft').item.json.body.content }}","type":"string"},{"id":"fbdd858a-fad6-4430-a3e6-eb4c7a62e1db","name":"recipient","value":"={{ $json.recipient }}","type":"string"},{"id":"022c240a-b58b-4bdc-854d-4be9f1e129ce","name":"sender_email","value":"={{ $json.sender_email }}","type":"string"},{"id":"723876e3-8cc2-4a38-ab00-8b4eb15f4602","name":"message_id","value":"={{ $json.message_id }}","type":"string"},{"id":"23be1d89-5be4-4824-adb9-7f6e56a5cb42","name":"outlook_draft_id","value":"={{ $json.outlook_draft_id }}","type":"string"},{"id":"5663d628-0f65-4528-805a-4853aac0c361","name":"id","value":"={{ $json.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-672,8416],"id":"cc126db3-df1f-408b-8373-d4a5a70b9f72","name":"Edit Fields6"},{"parameters":{"resource":"draft","operation":"get","draftId":{"__rl":true,"value":"={{ $json.outlook_draft_id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-2048,6288],"id":"7082922e-e812-4068-ae49-5a465108a9fe","name":"Get a draft","webhookId":"d3b8722f-192d-4640-b73d-f928e874ca07"},{"parameters":{"toRecipients":"={{ $json.to[0] }}","subject":"={{ $json[\"subject\"] }}","bodyContent":"={{ $json.bodyPreview }}\n","additionalFields":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-1840,6288],"id":"8de63957-ca35-4450-bff9-1a1161c981d3","name":"Send a message","webhookId":"6e023a48-58f8-44cf-8236-d327d5d9e3e7"},{"parameters":{"assignments":{"assignments":[{"id":"4fde9bb7-83a8-4eb6-9f98-c53e638d8b1e","name":"outlook_draft_id","value":"={{ $json.outlook_draft_id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2416,6352],"id":"59f946ca-fe41-4b11-8202-a9b1321406ea","name":"Edit Fields7","disabled":true},{"parameters":{"resource":"mail","fromEmail":"={{ $json.sender_email }}","fromName":"Shiva Engineering","toEmail":"={{ $json.recipient }}","subject":"={{ $json.subject }}","contentValue":"={{ $json.body }}","additionalFields":{}},"type":"n8n-nodes-base.sendGrid","typeVersion":1,"position":[-1616,6528],"id":"ad2c967a-3098-4ddc-a8fc-a20c26b23058","name":"Send an email"},{"parameters":{"content":"","height":112,"width":150},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1120,6240],"id":"dbe44c28-8648-4adb-8c87-ae93a1c278db","name":"Sticky Note8"},{"parameters":{"content":"","height":128,"width":150},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-2224,6288],"id":"6cbc6458-0d6a-4379-8a06-2a395d2c0813","name":"Sticky Note9"},{"parameters":{"contextWindowLength":20},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[-3712,8528],"id":"590f6ec1-6ebe-4b84-9465-124385e34ceb","name":"Simple Memory1"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-2560,6240],"id":"bc6c77e2-cbc8-4419-9235-732973e3f4ef","name":"Loop Over Items7"},{"parameters":{"amount":15},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-816,6288],"id":"ac1678b6-c3db-468a-98ab-24701482e898","name":"Wait8","webhookId":"c4cf719a-d47f-4761-8a16-aff92b8e9a19"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-2560,6720],"id":"a65dd4e3-1cb9-4ac5-8e4b-59a438000119","name":"Loop Over Items8"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-2560,7216],"id":"f85700db-c3c7-4295-9166-da4af3b10d50","name":"Loop Over Items9"},{"parameters":{"amount":15},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-2112,7280],"id":"2ed5ed8b-cc48-4866-b532-3c5ff5d85932","name":"Wait9","webhookId":"c4cf719a-d47f-4761-8a16-aff92b8e9a19"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-2560,5136],"id":"d4c64fae-a50d-4b09-ba56-71b72f9ced07","name":"Loop Over Items10"},{"parameters":{"amount":15},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-992,5104],"id":"d97916c9-8b1f-4ec2-bbc2-22259924a9a0","name":"Wait10","webhookId":"5fcbde9f-0750-405b-8ff7-8bce2e4a16ef"},{"parameters":{"jsCode":"// JavaScript code for n8n Code node to prepare HTML email for Gmail API\nconst emailData = {\n  messageId: $input.item.json['Message ID'],\n  threadId: $input.item.json['Thread ID'] || $input.item.json['Message ID'],\n  subject: $input.item.json['Email#1 Subject'],\n  senderEmail: $input.item.json['Sender Email'],\n  recipientEmail: $input.item.json['Email Address'],\n  token: $input.item.json['Token']\n};\n\n// Check available input keys to help diagnose the issue\nconst inputKeys = Object.keys($input.item.json);\nconsole.log('Available input keys:', inputKeys);\n\n// Try to find the email body in different possible formats\nlet emailBodyContent = '';\n// First try the exact key name\nif ($input.item.json['Email#2 Body'] !== undefined) {\n  emailBodyContent = $input.item.json['Email#2 Body'];\n} \n// Try with a space after the hash\nelse if ($input.item.json['Email #2 Body'] !== undefined) {\n  emailBodyContent = $input.item.json['Email #2 Body'];\n} \n// Try other possible variations\nelse if ($input.item.json['EmailBody'] !== undefined) {\n  emailBodyContent = $input.item.json['EmailBody'];\n} \n// Default fallback message if none found\nelse {\n  emailBodyContent = \"Thank you for your attention to this matter.\";\n  console.log(\"No email body found, using default text\");\n}\n\n// Ensure message ID is properly formatted\nconst formattedMessageId = emailData.messageId.startsWith('<') ? \n  emailData.messageId : \n  `<${emailData.messageId}>`;\n\n// Create HTML email body with unsubscribe link\nconst htmlBody = `${emailBodyContent}<br><br>\n<a href=\"https://kiaghasem.app.n8n.cloud/webhook/unsubscribe?tkn=${emailData.token}\">Click Here to Unsubscribe</a>`;\n\n// Create email in RFC 2822 format with HTML content type\nconst emailContent = \n  `In-Reply-To: ${formattedMessageId}\\n` +\n  `References: ${formattedMessageId}\\n` +\n  `Subject: Re: ${emailData.subject}\\n` +\n  `From: ${emailData.senderEmail}\\n` +\n  `To: ${emailData.recipientEmail}\\n` +\n  `Content-Type: text/html; charset=\"UTF-8\"\\n\\n` +\n  `${htmlBody}`;\n\n// Base64 encode and convert to base64url format\nconst base64EncodedEmail = Buffer.from(emailContent)\n  .toString('base64')\n  .replace(/\\+/g, '-')\n  .replace(/\\//g, '_')\n  .replace(/=+$/, '');\n\n// Return an object with the encoded email and thread ID\nreturn {\n  json: {\n    raw: base64EncodedEmail,\n    threadId: emailData.threadId\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1440,4960],"id":"04901859-f207-4c07-bb33-aa6cfdf48061","name":"Code9"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"177601be-b2c3-45cc-8e15-cd064fbaf578","leftValue":"={{ $('Edit Fields2').item.json.replied }}","rightValue":"Yes","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1456,4336],"id":"4eb95700-3a96-46fb-b359-4ab59185fc3f","name":"If9"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-2560,4432],"id":"799080b4-a4a2-403c-a125-18c5e6a36cb0","name":"Loop Over Items11"},{"parameters":{"amount":15},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-784,4416],"id":"02829ab9-30cd-49ad-94ce-243a589de440","name":"Wait11","webhookId":"5fcbde9f-0750-405b-8ff7-8bce2e4a16ef"},{"parameters":{"jsCode":"// JavaScript code for n8n Code node to prepare HTML email for Gmail API\nconst emailData = {\n  messageId: $input.item.json['Message ID'],\n  threadId: $input.item.json['Thread ID'] || $input.item.json['Message ID'],\n  subject: $input.item.json['Email#1 Subject'],\n  senderEmail: $input.item.json['Sender Email'],\n  recipientEmail: $input.item.json['Email Address'],\n  token: $input.item.json['Token']\n};\n\n// Check available input keys to help diagnose the issue\nconst inputKeys = Object.keys($input.item.json);\nconsole.log('Available input keys:', inputKeys);\n\n// Try to find the email body in different possible formats\nlet emailBodyContent = '';\n// First try the exact key name\nif ($input.item.json['Email#2 Body'] !== undefined) {\n  emailBodyContent = $input.item.json['Email#2 Body'];\n} \n// Try with a space after the hash\nelse if ($input.item.json['Email #2 Body'] !== undefined) {\n  emailBodyContent = $input.item.json['Email #2 Body'];\n} \n// Try other possible variations\nelse if ($input.item.json['EmailBody'] !== undefined) {\n  emailBodyContent = $input.item.json['EmailBody'];\n} \n// Default fallback message if none found\nelse {\n  emailBodyContent = \"Thank you for your attention to this matter.\";\n  console.log(\"No email body found, using default text\");\n}\n\n// Ensure message ID is properly formatted\nconst formattedMessageId = emailData.messageId.startsWith('<') ? \n  emailData.messageId : \n  `<${emailData.messageId}>`;\n\n// Create HTML email body with unsubscribe link\nconst htmlBody = `${emailBodyContent}<br><br>\n<a href=\"https://kiaghasem.app.n8n.cloud/webhook/unsubscribe?tkn=${emailData.token}\">Click Here to Unsubscribe</a>`;\n\n// Create email in RFC 2822 format with HTML content type\nconst emailContent = \n  `In-Reply-To: ${formattedMessageId}\\n` +\n  `References: ${formattedMessageId}\\n` +\n  `Subject: Re: ${emailData.subject}\\n` +\n  `From: ${emailData.senderEmail}\\n` +\n  `To: ${emailData.recipientEmail}\\n` +\n  `Content-Type: text/html; charset=\"UTF-8\"\\n\\n` +\n  `${htmlBody}`;\n\n// Base64 encode and convert to base64url format\nconst base64EncodedEmail = Buffer.from(emailContent)\n  .toString('base64')\n  .replace(/\\+/g, '-')\n  .replace(/\\//g, '_')\n  .replace(/=+$/, '');\n\n// Return an object with the encoded email and thread ID\nreturn {\n  json: {\n    raw: base64EncodedEmail,\n    threadId: emailData.threadId\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1232,4240],"id":"0e6e3bdc-91ef-42b9-a524-b44b6d658f9a","name":"Code10"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"177601be-b2c3-45cc-8e15-cd064fbaf578","leftValue":"={{ $json.replied }}","rightValue":"Yes","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1664,5728],"id":"c565b29b-7c3f-44c7-9dcd-6e628aa64058","name":"If11"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-2560,5824],"id":"f602ab09-9a23-4dc2-b2bf-41b68a84afd6","name":"Loop Over Items12"},{"parameters":{"amount":15},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-992,5808],"id":"5226fa9d-427d-4685-8de4-01d1ee67855f","name":"Wait12","webhookId":"5fcbde9f-0750-405b-8ff7-8bce2e4a16ef"},{"parameters":{"method":"POST","url":"https://www.googleapis.com/gmail/v1/users/me/messages/send","authentication":"predefinedCredentialType","nodeCredentialType":"gmailOAuth2","sendBody":true,"bodyParameters":{"parameters":[{"name":"raw","value":"={{ $json.raw }}"},{"name":"=threadId","value":"={{ $json.threadId }}"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1216,5568],"id":"c84c328a-5309-4dda-98fc-594a6eb67fa9","name":"HTTP Request"},{"parameters":{"content":"## WORKFLOW 3 \n\n## ONCE REPLY IS RECEIVED - IT DRAFTS A REPLY MAIL \n\n## WAITS FOR BD MANAGER APPROVAL \n","height":2000,"width":3296,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-3776,4064],"id":"4c75e697-7fbf-4012-aaba-ecb39ff256a9","name":"Sticky Note6"},{"parameters":{"content":"## WORKFLOW 2 \n\n## TRIGGERED ONCE APPROVAL IS RECEIVED BY BD MANAGER \n\n## SEND MAILS TO APPOVED ONES","height":1456,"width":2912,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-3728,6096],"id":"3f7ef863-7d52-443e-8bf4-ebc5c62e5ea8","name":"Sticky Note10"},{"parameters":{"jsCode":"// Get the string from input (AI Agent output)\nconst raw = $json.output;\n\n// Parse the string into JSON\nconst parsed = JSON.parse(raw);\n\n// Return each item as its own item\nreturn parsed.map(item => ({ json: item }));\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-3280,8304],"id":"2fb1c8a2-1b15-428c-b0fe-a93ead97fc80","name":"Code11"},{"parameters":{"content":"## WORKFLOW 1 \n\n## IDENTIFIES POTENTIAL PROJECTS \n\n## DRAFTS OUTLOOK MAIL IN PROPER FORMAT","height":960,"width":3408,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-4208,7904],"id":"a263f65c-2293-4239-a4bc-d9e704d56496","name":"Sticky Note11"},{"parameters":{"content":"## PERSONALISATION + PAIN-POINTS + HOW SES CAN HELP ?","height":608,"width":406},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-3104,8032],"id":"90bf179a-0e6f-4383-b10e-3a75a03146cb","name":"Sticky Note12"},{"parameters":{"content":"## FORMATS AND DRAFTS COLD PERSONALISED MAILS","height":560,"width":1472,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-2608,8048],"id":"381d0518-2610-4a89-afb4-2197f0821bf1","name":"Sticky Note13"},{"parameters":{"tableId":"email_drafts","fieldsUi":{"fieldValues":[{"fieldId":"recipient","fieldValue":"={{ $json.to_emails }}"},{"fieldId":"sender_email","fieldValue":"={{ $json.from_email }}"},{"fieldId":"subject","fieldValue":"={{ $json.subject }}"},{"fieldId":"body","fieldValue":"={{ $json.body_text }}"},{"fieldId":"status","fieldValue":"sent"},{"fieldId":"delivered_status","fieldValue":"delivered"},{"fieldId":"message_id","fieldValue":"={{ $json.id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1248,6208],"id":"46a2ffda-cae1-4587-b3de-60775696641d","name":"Create a row1"},{"parameters":{"content":"## KHUSHI","height":5616,"width":4304,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-4528,3840],"id":"dc25ad44-59bf-4002-9bc6-930fb1115ee9","name":"Sticky Note14"},{"parameters":{"assignments":{"assignments":[{"id":"71c05052-a399-42e1-a493-3085aa7f26d1","name":"subject","value":"={{ $json.subject }}","type":"string"},{"id":"14a37df6-9581-4603-a9f1-5ce8f8248a8d","name":"body_text","value":"={{ $json.body.content }}","type":"string"},{"id":"0a1b48c6-025d-4ca0-802b-67089989f7bc","name":"to_emails","value":"={{ $json.toRecipients[0].emailAddress.address }}","type":"string"},{"id":"047c2f53-6c5d-4386-bdcd-184c3af65bb7","name":"from_email","value":"={{ $json.from.emailAddress.address }}","type":"string"},{"id":"b7c6728c-61ee-44c3-bd03-2b8015ac9a75","name":"from_name","value":"={{ $json.from.emailAddress.name }}","type":"string"},{"id":"b91a5ac5-5bca-4223-ab4c-a911c8d15297","name":"id","value":"={{ $json.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[49360,4800],"id":"8293d469-0612-4198-83ae-d60b409f9d64","name":"Edit Fields"},{"parameters":{"operation":"update","tableId":"email_drafts","filters":{"conditions":[{"keyName":"id","condition":"eq","keyValue":"={{ $json.id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"status","fieldValue":"sent"},{"fieldId":"delivered_status","fieldValue":"delivered"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[49840,4848],"id":"be0b8483-9e84-4e90-a4bb-d9f20c66dc5c","name":"Update a row1"},{"parameters":{"url":"=https://graph.microsoft.com/v1.0/me/messages/{{ $('Loop Over Items17').item.json.outlook_draft_id }}?$select=subject,body,toRecipients,ccRecipients,bccRecipients,replyTo,sender,from&$expand=attachments\n","authentication":"genericCredentialType","genericAuthType":"oAuth2Api","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[49168,4848],"id":"5189f535-eed7-468c-b871-683014e3cbf0","name":"Get Message Metadata1"},{"parameters":{"resource":"draft","operation":"get","draftId":{"__rl":true,"value":"={{ $json.outlook_draft_id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[48768,4848],"id":"08c56d87-ebbb-45b3-9564-c57b0ceb1872","name":"Get a draft1","webhookId":"d3b8722f-192d-4640-b73d-f928e874ca07"},{"parameters":{"operation":"update","tableId":"email_drafts","filters":{"conditions":[{"keyName":"id","condition":"eq","keyValue":"={{ $json.id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"status","fieldValue":"sent"},{"fieldId":"delivered_status","fieldValue":"delivered"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[49872,5344],"id":"fac16661-093e-4f66-9031-4487e5c24265","name":"Update a row2"},{"parameters":{"url":"=https://graph.microsoft.com/v1.0/me/messages/{{ $('Loop Over Items18').item.json.outlook_draft_id }}?$select=subject,body,toRecipients,ccRecipients,bccRecipients,replyTo,sender,from&$expand=attachments\n","authentication":"genericCredentialType","genericAuthType":"oAuth2Api","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[49200,5344],"id":"db258e09-3195-489a-b3a0-dd93cf98755a","name":"Get Message Metadata2"},{"parameters":{"resource":"draft","operation":"get","draftId":{"__rl":true,"value":"={{ $json.outlook_draft_id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[48800,5344],"id":"c6d20cf9-2602-482e-96da-9da0dda835c9","name":"Get a draft2","webhookId":"d3b8722f-192d-4640-b73d-f928e874ca07"},{"parameters":{"tableId":"email_drafts","fieldsUi":{"fieldValues":[{"fieldId":"recipient","fieldValue":"={{ $json.to_emails }}"},{"fieldId":"sender_email","fieldValue":"={{ $json.from_email }}"},{"fieldId":"subject","fieldValue":"={{ $json.subject }}"},{"fieldId":"body","fieldValue":"={{ $json.body_text }}"},{"fieldId":"status","fieldValue":"sent"},{"fieldId":"delivered_status","fieldValue":"delivered"},{"fieldId":"message_id","fieldValue":"={{ $json.id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[49584,5264],"id":"52f83faa-903f-424a-bbd3-49f9df23b2cd","name":"Create a row2"},{"parameters":{"options":{"systemMessage":"=You are a business development assistant for Shiva Engineering Services (SES). You are given rows of project data from a PostgreSQL (Supabase) table.\n\nYour task is to filter and return a list of *potential projects* for SES to target.\n\n**Definition of a potential project:**\n- The \"Contractor\" column is empty for that project .\n- The \"Latest Update\" column does NOT contain phrases like:\n  - \"bagged a contract\"\n  - \"project is in progress\"\n  - \"bids were invited\"\n  - \"waiting for approvals\"\n  - or anything that suggests the project is already assigned or underway.\n\n**Output requirement:**\n- Return an array of JSON objects.\n- Each object should include:\n  - `Project_ID`\n  - All available details from the row (e.g. Project annoucement date , Latest Update , Industry , Ownership , Location, Estimated Cost, etc.).\n- Sort by the most recently updated projects first ; else sort by most potential ones ).\n\nOnly return projects that truly match the criteria. If unsure, exclude the row.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[47040,6400],"id":"266d25c1-8915-42a7-9211-bd1197268eee","name":"AI Agent1"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[46944,6640],"id":"ff543144-6e6f-414d-b03d-95a6a0f07677","name":"OpenAI Chat Model2"},{"parameters":{"operation":"select","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"Project","mode":"list","cachedResultName":"Project"},"returnAll":true,"options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[47344,6624],"id":"3335b9c2-b68c-4694-80af-fdf6077ed548","name":"Select rows from a table in Postgres1"},{"parameters":{"modelId":{"__rl":true,"value":"chatgpt-4o-latest","mode":"list","cachedResultName":"CHATGPT-4O-LATEST"},"messages":{"values":[{"content":"=You are part of the cold email team for SES , which is an AI Automation Agency offering process automation, marketing automation and automation consulting to businesses around the world. \n\nYour job is to create 3 emails given the following info about a new cold lead: \n\n1. Research: Findings about the prospect by researching them on social media and the web. \n2. Analysis: Insights extracted from analysing the research. \n3. Tactic: Strategy to create the cold emails. \n\nYour job is to create a cold email sequence of 2 emails for the purpose of A/B testing. The tactic for each email should closely follow the instructions below, whilst the content of each email must follow the research and analysis. \n\n\n# Tactic: \n\n1. Email#1: \n\n1.1 Recepient \n    \"To\" field - Contact Person Email , if available .\n\n    \n\n1.2 Subject line: \n\nThe email subject line should : \n- Be maximum 4-6 words \n- Include the prospects name or company name (choose based on context) when possible without sounding unnatural \n- Never include spam trigger words like ‚Äúfree,‚Äù ‚Äúguarantee,‚Äù ‚Äúno obligation,‚Äù \"price,\" \"100%\" \"sale,\" and excessive punctuation, which can trigger spam filters. \n- Create curiousity without sounding spammy or like we're selling them anything \n\n\n1.3 Body\n\nStructure: The email must follow this structure closely:\na) Hook: The first 2 or 3 sentences of the email is a hook. The hook should be the personalization part of the email, capturing the prospects attention so they don't scroll. \nb) Pain point: After the hook, you must outline a pain point that was analysed about the prospect. This shouldn't sound salesy, but should be directly related to their business. The goal is to capture the readers attention, not sell them a solution. \nc) CTA: Say you've been working on solving that problem and would love to share your insights over a quick 15 minute call on {{ ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'][(new Date().getDay() + 2) % 7] }}. Have a clear next step for them (for example \"Should I book you in?).\n\nGuidelines -  The email body should:\n\n- Be short (maximum 100 words).\n- Have short paragraphs (1 or 2 sentences in each) to include white space. \n- Use a conversational tone to keep the email casual. \n- Be \"You\" focused, incorporating \"you\" as much as possible.\n- Be in 6th-grade reading level with simple language. \n- Avoid images, attachments, videos, custom code, spammy words above, bullet points, punctuation.\n- Not have absurd claims (it should be believable).\n- Should always start with \"Hey ,\"\n- Should be concise. \n- Never start with formal openers like \"Hope you're doing well\" (Get right into the email every time).\n- Be nice and inviting.\n- End with \"Kind regards, Khushi \"\n\n\n2. Email#2: \nThis email will be the alternative email ( Subject and body framed in a different way ) as email#1 and is considered to be avaluated by manager via A/B testing that which email fits the best in context .  \n \n\n# Rules - Other things to consider: \n- Your goal is to create an engaging email that will get us a reply. Choose the best pain points and personalization opportunities from the analysis to achieve this objective. \n- You must closely follow the guidelines provided for each email. \n- Never come across condescending or rude when mentioning the pain point. \n- When using the personalization opportunities from the analysis, always mention where the info was found - usually  \"Online\" or \"LinkedIn\" (look at Supporting Evidence for this).\n\n# Output format\nYour output must follow this JSON format: \n\n{ \n  \"to\": \"Contact Person Email \" , \n  \"email1\": {\n    \"subject\": \"TEXT-HERE\",\n    \"body\": \"HTML-HERE\"\n  },\n  \"email2\": {\n     \"subject\": \"TEXT-HERE\",\n     \"body\": \"HTML-HERE\"\n  },\n\n}\n\n- Don't wrap the output in ```json```. \n- Don't output anything else. \n- Don't use HTML code , use only next line character ( \"\\n\") for line breaks and nothing else.\n\n# Task: New prospect\nThere's a new prospect. Create the emails by considering the following details: \n\n1. Analysis: \n{{ $json.message.content }} \n"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[48224,6416],"id":"92bee785-dedc-4068-9077-56e7ea87bf86","name":"Email #1 #2 #"},{"parameters":{"mode":"raw","jsonOutput":"=  {{ $json.message.content.replaceAll('```json','').replaceAll('```','') }}\n\n\n","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[48592,6416],"id":"d86dcb46-e917-4182-b921-bc084622044b","name":"Emails1","onError":"continueRegularOutput"},{"parameters":{"jsCode":"// Loop over each item passed from the Merge node\nfor (const item of items) {\n\t// Get the country value (make sure to match the field name exactly)\n\tconst countryRaw = item.json[\"Country \"];\n\tlet country = \"\";\n\tif (countryRaw) {\n\t\tcountry = countryRaw.toLowerCase().trim();\n\t}\n\n\t// Define arrays for the different time zone groups\n\tconst t1Countries = [\"usa\", \"united states\", \"canada\"];\n\tconst europeanCountries = [\n\t\t\"albania\", \"andorra\", \"armenia\", \"austria\", \"azerbaijan\", \"belarus\", \"belgium\",\n\t\t\"bosnia and herzegovina\", \"bulgaria\", \"croatia\", \"cyprus\", \"czech republic\", \"czechia\",\n\t\t\"denmark\", \"estonia\", \"finland\", \"france\", \"georgia\", \"germany\", \"greece\", \"hungary\",\n\t\t\"iceland\", \"ireland\", \"italy\", \"kosovo\", \"latvia\", \"liechtenstein\", \"lithuania\",\n\t\t\"luxembourg\", \"malta\", \"moldova\", \"monaco\", \"montenegro\", \"netherlands\", \"north macedonia\",\n\t\t\"norway\", \"poland\", \"portugal\", \"romania\", \"russia\", \"san marino\", \"serbia\", \"slovakia\",\n\t\t\"slovenia\", \"spain\", \"sweden\", \"switzerland\", \"turkey\", \"ukraine\", \"united kingdom\",\n\t\t\"vatican city\"\n\t];\n\tconst t3Countries = [\"australia\", \"new zealand\"];\n\n\t// Determine and populate the Time Zone based on the country value\n\tif (t1Countries.includes(country)) {\n\t\titem.json[\"Time Zone\"] = \"T1\";\n\t} else if (europeanCountries.includes(country)) {\n\t\titem.json[\"Time Zone\"] = \"T2\";\n\t} else if (t3Countries.includes(country)) {\n\t\titem.json[\"Time Zone\"] = \"T3\";\n\t} else {\n\t\t// For any other country not defined above, assign T4.\n\t\t// If you want to limit to T1, T2, or T3 only, you can decide to leave it blank or assign a default value.\n\t\titem.json[\"Time Zone\"] = \"T4\";\n\t}\n}\n\nreturn items;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[48752,6416],"id":"2222fed0-d1c7-43bd-bc4d-2088827e0fa7","name":"Time Zone1"},{"parameters":{"jsCode":"// Array of sender emails to rotate through\nconst senderEmails = [\n  \"marketing@shiva-engineering.com\",\n  \"hardik@thelinkai.com\",\n  \"ydvkhushi721@gmail.com\"\n];\n\n// Get all input items from the Time Zone node\nconst items = $input.all();\n\n// Process each item\nfor (let i = 0; i < items.length; i++) {\n  // Calculate which email to use based on position (cycling through the array)\n  const emailIndex = i % senderEmails.length;\n  \n  // Assign the sender email to the current item\n  items[i].json[\"Sender Email\"] = senderEmails[emailIndex];\n}\n\n// Return the updated items\nreturn items;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[48912,6416],"id":"c7d56e1c-00fc-4746-9c02-6d782e77a969","name":"Sender Email1"},{"parameters":{"jsCode":"// Function to generate a random 6-digit number\nfunction generateRandomToken() {\n  return Math.floor(100000 + Math.random() * 900000);\n}\n\n// Process each item from the Sender Email node\nfor (let i = 0; i < items.length; i++) {\n  // Add the token parameter to each item\n  items[i].json.token = generateRandomToken();\n}\n\n// Return the modified items\nreturn items;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[49088,6416],"id":"b7478fbd-b264-4dca-a51f-0073743aa91d","name":"Opt Out Token1"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.sender_email }}","rightValue":"marketing@shiva-engineering.com","operator":{"type":"string","operation":"equals"},"id":"b895fd00-6f66-41d1-ab55-b1337e744a7f"}],"combinator":"and"},"renameOutput":true,"outputKey":"kgd"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b90ae81e-e015-4138-955b-f8efae253fba","leftValue":"={{ $json.sender_email }}","rightValue":"kykhushi0703@gmail.com","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"k"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"93b60147-610f-4c3c-adf6-a7f8b2159096","leftValue":"={{ $json.sender_email }}","rightValue":"hardik@thelinkai.com","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"h"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[47920,4384],"id":"37808d42-a223-4850-ab24-04856b93dc3b","name":"Switch2"},{"parameters":{"rule":{"interval":[{"field":"cronExpression","expression":"0 11 * * Mon"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[46944,4864],"id":"ee65aa7a-1d16-45fd-b561-580c78d85865","name":"Schedule Trigger","disabled":true},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.sender_email }}","rightValue":"marketing@shiva-engineering.com","operator":{"type":"string","operation":"equals"},"id":"b895fd00-6f66-41d1-ab55-b1337e744a7f"}],"combinator":"and"},"renameOutput":true,"outputKey":"kgd"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b90ae81e-e015-4138-955b-f8efae253fba","leftValue":"={{ $json.sender_email }}","rightValue":"kykhushi0703@gmail.com","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"k"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"93b60147-610f-4c3c-adf6-a7f8b2159096","leftValue":"={{ $json.sender_email }}","rightValue":"youremail@gmail.com","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"h"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[48016,3232],"id":"1e54e10c-ae48-468f-8452-288bd94c0d22","name":"Switch3"},{"parameters":{"assignments":{"assignments":[{"id":"2d1b89f0-661b-4b21-9bb2-cb8419b22035","name":"replied","value":"={{ Object.keys($json).length > 0 ? \"Yes\" : \"No\" }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[48880,3264],"id":"24ad2f38-1424-41ec-89ac-3dcaca408bf2","name":"Edit Fields4"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"177601be-b2c3-45cc-8e15-cd064fbaf578","leftValue":"={{ $json.replied }}","rightValue":"Yes","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[49216,3248],"id":"80858a83-02ba-408e-aec2-04b0317baeda","name":"If12"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[49040,3248],"id":"3cb573a8-6392-499a-861f-20e21016e01f","name":"Merge"},{"parameters":{"operation":"appendOrUpdate","documentId":{"__rl":true,"value":"1pY5nJihyUUObA1LpbhdgANq0DSX7A9TLOTWlEr9PMBk","mode":"list","cachedResultName":"Research","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1pY5nJihyUUObA1LpbhdgANq0DSX7A9TLOTWlEr9PMBk/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1pY5nJihyUUObA1LpbhdgANq0DSX7A9TLOTWlEr9PMBk/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"LinkedIn URL":"={{ $json[\"LinkedIn URL\"] }}","Replied":"Yes"},"matchingColumns":["LinkedIn URL"],"schema":[{"id":"First Name","displayName":"First Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Last Name","displayName":"Last Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email Address","displayName":"Email Address","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Phone Number","displayName":"Phone Number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Country ","displayName":"Country ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Location","displayName":"Location","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Industry","displayName":"Industry","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Company Name","displayName":"Company Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Job Title","displayName":"Job Title","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Seniority","displayName":"Seniority","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Website URL","displayName":"Website URL","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"LinkedIn URL","displayName":"LinkedIn URL","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Analysed","displayName":"Analysed","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Research Report","displayName":"Research Report","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#1 Body","displayName":"Email#1 Body","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#1 Subject","displayName":"Email#1 Subject","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email #2 Body","displayName":"Email #2 Body","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#3 Body","displayName":"Email#3 Body","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#3 Subject","displayName":"Email#3 Subject","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Sender Email","displayName":"Sender Email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Time Zone","displayName":"Time Zone","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#1 Sent","displayName":"Email#1 Sent","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#2 Sent","displayName":"Email#2 Sent","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#3 Sent","displayName":"Email#3 Sent","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Message ID","displayName":"Message ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Replied","displayName":"Replied","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Token","displayName":"Token","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Opted Out","displayName":"Opted Out","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[49424,3248],"id":"0c400ef3-4478-4620-a7f3-bbc48b92090a","name":"Replied = Yes"},{"parameters":{"method":"POST","url":"https://www.googleapis.com/gmail/v1/users/me/messages/send","authentication":"predefinedCredentialType","nodeCredentialType":"gmailOAuth2","sendBody":true,"bodyParameters":{"parameters":[{"name":"raw","value":"={{ $json.raw }}"},{"name":"=threadId","value":"={{ $json.threadId }}"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[49616,3072],"id":"4ccc05b0-47ad-446a-8d68-eecc6cf7bdd8","name":"HTTP Request5"},{"parameters":{"assignments":{"assignments":[{"id":"2d1b89f0-661b-4b21-9bb2-cb8419b22035","name":"replied","value":"={{ Object.keys($json).length > 0 ? \"Yes\" : \"No\" }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[48880,2560],"id":"86e4c2d5-f39a-4364-aa88-b72c98206bb3","name":"Edit Fields8"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[49088,2544],"id":"1f5aef84-89e3-4a39-9137-53ebd271c10b","name":"Merge4"},{"parameters":{"operation":"appendOrUpdate","documentId":{"__rl":true,"value":"1pY5nJihyUUObA1LpbhdgANq0DSX7A9TLOTWlEr9PMBk","mode":"list","cachedResultName":"Research","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1pY5nJihyUUObA1LpbhdgANq0DSX7A9TLOTWlEr9PMBk/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1pY5nJihyUUObA1LpbhdgANq0DSX7A9TLOTWlEr9PMBk/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"LinkedIn URL":"={{ $json[\"LinkedIn URL\"] }}","Replied":"Yes"},"matchingColumns":["LinkedIn URL"],"schema":[{"id":"First Name","displayName":"First Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Last Name","displayName":"Last Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email Address","displayName":"Email Address","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Phone Number","displayName":"Phone Number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Country ","displayName":"Country ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Location","displayName":"Location","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Industry","displayName":"Industry","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Company Name","displayName":"Company Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Job Title","displayName":"Job Title","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Seniority","displayName":"Seniority","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Website URL","displayName":"Website URL","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"LinkedIn URL","displayName":"LinkedIn URL","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Analysed","displayName":"Analysed","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Research Report","displayName":"Research Report","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#1 Body","displayName":"Email#1 Body","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#1 Subject","displayName":"Email#1 Subject","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email #2 Body","displayName":"Email #2 Body","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#3 Body","displayName":"Email#3 Body","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#3 Subject","displayName":"Email#3 Subject","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Sender Email","displayName":"Sender Email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Time Zone","displayName":"Time Zone","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#1 Sent","displayName":"Email#1 Sent","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#2 Sent","displayName":"Email#2 Sent","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#3 Sent","displayName":"Email#3 Sent","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Message ID","displayName":"Message ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Replied","displayName":"Replied","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Token","displayName":"Token","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Opted Out","displayName":"Opted Out","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[49472,2528],"id":"051e7f76-8d77-4af3-9043-93b0077ba4c3","name":"Replied = Yes4"},{"parameters":{"method":"POST","url":"https://www.googleapis.com/gmail/v1/users/me/messages/send","authentication":"predefinedCredentialType","nodeCredentialType":"gmailOAuth2","sendBody":true,"bodyParameters":{"parameters":[{"name":"raw","value":"={{ $json.raw }}"},{"name":"=threadId","value":"={{ $json.threadId }}"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[49792,2352],"id":"9a1263da-b653-4926-9949-918c9bf67c1c","name":"HTTP Request7"},{"parameters":{"assignments":{"assignments":[{"id":"2d1b89f0-661b-4b21-9bb2-cb8419b22035","name":"replied","value":"={{ Object.keys($json).length > 0 ? \"Yes\" : \"No\" }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[48832,3872],"id":"2dff2a93-d230-4657-ac04-89034debd2ad","name":"Edit Fields9"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[48928,3680],"id":"21563482-4e54-4be1-ac0c-614635e534c9","name":"Merge5"},{"parameters":{"operation":"appendOrUpdate","documentId":{"__rl":true,"value":"1pY5nJihyUUObA1LpbhdgANq0DSX7A9TLOTWlEr9PMBk","mode":"list","cachedResultName":"Research","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1pY5nJihyUUObA1LpbhdgANq0DSX7A9TLOTWlEr9PMBk/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1pY5nJihyUUObA1LpbhdgANq0DSX7A9TLOTWlEr9PMBk/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"LinkedIn URL":"={{ $json[\"LinkedIn URL\"] }}","Replied":"Yes"},"matchingColumns":["LinkedIn URL"],"schema":[{"id":"First Name","displayName":"First Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Last Name","displayName":"Last Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email Address","displayName":"Email Address","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Phone Number","displayName":"Phone Number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Country ","displayName":"Country ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Location","displayName":"Location","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Industry","displayName":"Industry","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Company Name","displayName":"Company Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Job Title","displayName":"Job Title","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Seniority","displayName":"Seniority","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Website URL","displayName":"Website URL","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"LinkedIn URL","displayName":"LinkedIn URL","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Analysed","displayName":"Analysed","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Research Report","displayName":"Research Report","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#1 Body","displayName":"Email#1 Body","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#1 Subject","displayName":"Email#1 Subject","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email #2 Body","displayName":"Email #2 Body","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#3 Body","displayName":"Email#3 Body","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#3 Subject","displayName":"Email#3 Subject","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Sender Email","displayName":"Sender Email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Time Zone","displayName":"Time Zone","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#1 Sent","displayName":"Email#1 Sent","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#2 Sent","displayName":"Email#2 Sent","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email#3 Sent","displayName":"Email#3 Sent","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Message ID","displayName":"Message ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Replied","displayName":"Replied","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Token","displayName":"Token","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Opted Out","displayName":"Opted Out","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[49360,3936],"id":"a26e8a67-ac53-4865-91ce-7f9dfe30472b","name":"Replied = Yes5"},{"parameters":{"jsCode":"// JavaScript code for n8n Code node to prepare HTML email for Gmail API\nconst emailData = {\n  messageId: $input.item.json['Message ID'],\n  threadId: $input.item.json['Thread ID'] || $input.item.json['Message ID'],\n  subject: $input.item.json['Email#1 Subject'],\n  senderEmail: $input.item.json['Sender Email'],\n  recipientEmail: $input.item.json['Email Address'],\n  token: $input.item.json['Token']\n};\n\n// Check available input keys to help diagnose the issue\nconst inputKeys = Object.keys($input.item.json);\nconsole.log('Available input keys:', inputKeys);\n\n// Try to find the email body in different possible formats\nlet emailBodyContent = '';\n// First try the exact key name\nif ($input.item.json['Email#2 Body'] !== undefined) {\n  emailBodyContent = $input.item.json['Email#2 Body'];\n} \n// Try with a space after the hash\nelse if ($input.item.json['Email #2 Body'] !== undefined) {\n  emailBodyContent = $input.item.json['Email #2 Body'];\n} \n// Try other possible variations\nelse if ($input.item.json['EmailBody'] !== undefined) {\n  emailBodyContent = $input.item.json['EmailBody'];\n} \n// Default fallback message if none found\nelse {\n  emailBodyContent = \"Thank you for your attention to this matter.\";\n  console.log(\"No email body found, using default text\");\n}\n\n// Ensure message ID is properly formatted\nconst formattedMessageId = emailData.messageId.startsWith('<') ? \n  emailData.messageId : \n  `<${emailData.messageId}>`;\n\n// Create HTML email body with unsubscribe link\nconst htmlBody = `${emailBodyContent}<br><br>\n<a href=\"https://kiaghasem.app.n8n.cloud/webhook/unsubscribe?tkn=${emailData.token}\">Click Here to Unsubscribe</a>`;\n\n// Create email in RFC 2822 format with HTML content type\nconst emailContent = \n  `In-Reply-To: ${formattedMessageId}\\n` +\n  `References: ${formattedMessageId}\\n` +\n  `Subject: Re: ${emailData.subject}\\n` +\n  `From: ${emailData.senderEmail}\\n` +\n  `To: ${emailData.recipientEmail}\\n` +\n  `Content-Type: text/html; charset=\"UTF-8\"\\n\\n` +\n  `${htmlBody}`;\n\n// Base64 encode and convert to base64url format\nconst base64EncodedEmail = Buffer.from(emailContent)\n  .toString('base64')\n  .replace(/\\+/g, '-')\n  .replace(/\\//g, '_')\n  .replace(/=+$/, '');\n\n// Return an object with the encoded email and thread ID\nreturn {\n  json: {\n    raw: base64EncodedEmail,\n    threadId: emailData.threadId\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[49360,3680],"id":"2e34c7cd-5a46-4cf0-a7ec-2329f227e03a","name":"Code12"},{"parameters":{"resource":"draft","subject":"={{ $json.email1.subject }}","bodyContent":"={{ $json.email1.body }}","additionalFields":{"from":"={{ $json['Sender Email'] }}","isReadReceiptRequested":false,"toRecipients":"={{ $json.to }}"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[49248,6416],"id":"12fbed6d-0c01-45f3-9a0c-6c91ba56dba0","name":"Create a draft1","webhookId":"5c2ccbbb-fe33-4b32-8e83-34405dfbd681"},{"parameters":{"method":"POST","url":"https://pvckiiclgzdzwcsxtekg.supabase.co/rest/v1/email_drafts","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB2Y2tpaWNsZ3pkendjc3h0ZWtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1MjMyMTksImV4cCI6MjA2ODA5OTIxOX0.at2jET1WoXwOxjWx-ORAiu6qFsn9KW-bUMM4Tn64Qlw"},{"name":"Authorization","value":"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB2Y2tpaWNsZ3pkendjc3h0ZWtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1MjMyMTksImV4cCI6MjA2ODA5OTIxOX0.at2jET1WoXwOxjWx-ORAiu6qFsn9KW-bUMM4Tn64Qlw"},{"name":"Content-Type","value":"application/json"},{"name":"Prefer","value":"return=representation"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"subject\": \"{{$json.subject}}\",\n  \"body\": \"testing body\",\n  \"recipient\": \"{{$json.toRecipients[0].emailAddress.address}}\",\n  \"status\": \"draft\",\n  \"outlook_draft_id\": \"{{$json.id}}\",\n  \"created_by\": \"{{$json.from.emailAddress.name}}\",\n  \"sender_email\": \"{{$json.sender.emailAddress.address}}\",\n  \"message_id\": \"{{$json.internetMessageId}}\",\n  \"delivered_status\": \"pending\",\n  \"replied\": false\n}\n","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[49440,6416],"id":"2d3fffbc-47d2-4f52-9a97-27ad4fc39795","name":"Insert to Supabase1"},{"parameters":{"modelId":{"__rl":true,"value":"chatgpt-4o-latest","mode":"list","cachedResultName":"CHATGPT-4O-LATEST"},"messages":{"values":[{"content":"=You are a Project Insights Specialist helping SES Engineering identify how it can add strategic value to a given infrastructure or industrial project. Based on the fields provided, your job is to analyze the project and generate personalized insights for cold outreach that are:\n\n- Relevant to the project context\n\n- Tied directly to SES Engineering's capabilities\n\n- Helpful and technically clear\n\n- Strictly grounded in the input fields (no hallucination)\n\n## SES Engineering Summary\nSES Engineering delivers end-to-end Engineering, Procurement, and Construction (EPC) services, focused on quality, safety, sustainability, and innovation. Their team ensures seamless execution‚Äîfrom initial design to commissioning‚Äîbringing projects to life on-time and on-budget.\n\n#Core Offerings:\n- Site Master Planning (SMP): Layout optimization, space utilization, CAPEX/OPEX efficiency\n\n- Front-End Engineering Design (FEED): Early-stage risk mitigation, predictability in cost/timelines\n\n- Multi-Disciplinary Design & Lifecycle Support: Mechanical, civil, electrical, instrumentation\n\n- Procurement Strategy & Vendor Management: Supply-chain efficiency, long-lead item planning\n\n- Process Scale-Up Expertise ( Scale up Engineering): From pilot to full-scale production, throughput optimization . Helps small enterprises grow scalably . \n\n- Prefabrication & Modular Construction: Time-saving, reduced on-site congestion, parallel execution\n\n## Objective\n#Your Goal:\n Generate project-specific insights for cold outreach by:\n\n- Finding strong personalization opportunities using only the structured fields below\n\n- Identifying pain points or risks (if applicable) based on stage, cost, or complexity\n\n- Mapping how SES can help, connecting each point clearly to SES capabilities\n\n## Structured Input Fields\nThe input will contain structured fields like:\n\n1. Project Name\n\n2. Project Type\n\n3. Implementation Stage\n\n4. Construction Start & End Dates\n\n5. Cost or Estimated Cost Range\n\n6. Industry\n\n7. Ownership\n\n8. Location, State, District\n\n10. Product1 / Product2\n\n11. Promoter Name / Promoter Details\n\n12. Latest Update (may contain recent news or progress info)\n\n‚ùå Constraints\n- Never invent any roles, people, or project details not given in input\n\n- Do not generalize or assume facts‚Äîuse only what‚Äôs in the fields\n\n- If nothing meaningful is available in a field, ignore it gracefully\n\n## OUTPUT FORMAT \n\n#Personalization\n- Opportunity 1: <specific personalized insight grounded in the input>\n- Opportunity 2: <another insight‚Äîoptional if none available>\n\n#Pain Points\n- <Optional risk or challenge inferred from cost, stage, or timeline>  \n  (e.g., ‚ÄúPossible execution delays due to early-stage planning + high cost‚Äù)\n\n#How SES Can Help\nSES can support this project by <explain using SES capabilities>.\n- Given the current stage (e.g., {{ $json['Implementation Stage'] }}), SES would [insert applicable offering like FEED, SMP, scale-up help]\n- To overcome [pain point], SES applies [specific capability]\n- As the project relates to {{ $json.Industry }}   and involves {{ $json.Product1 }} , SES brings expertise in [relevant domain]\n\n#Supporting Evidence\n- Project Name: {{ $json['Project Name'] }}\n- Promoter: {{ $json['Promoter Name'] }}\n- Industry: {{ $json.Industry }}\n- Implementation Stage: {{ $json['Implementation Stage'] }}\n- Latest Update: {{ $json['Latest Update'] }}\n\n# CONTACT DETAILS\n-Contact person name : {{ $json['Promoter_Contact Person Name'] }}\n- Contact person Designation : {{ $json['Promoter_Contact Person_Designation'] }}\n- Contact person Phone Number : {{ $json['Promoter_Contact Person_Direct Contact'] }}\n-Contact person Email : {{ $json['Promoter_Contact Person_Email'] }}\n\nNOTE : If contact person information is not there , return \" no contact details provided \"\n\n# Examples of Useful Opening Lines in Output:\n\n‚ÄúSES can support this project by providing FEED services to lay a strong technical foundation before EPC begins.‚Äù\n\n‚ÄúGiven the early planning stage and complex scale, SES would apply its SMP and procurement expertise to reduce risk and cost.‚Äù\n\n‚ÄúTo address potential delays mentioned in the Latest Update, SES‚Äôs modular construction capability can accelerate timelines and minimize on-site bottlenecks.‚Äù"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[47776,6416],"id":"36014328-f2b3-47dc-b40e-e273ca9f7a53","name":"Analyze1"},{"parameters":{"url":"https://pvckiiclgzdzwcsxtekg.supabase.co/rest/v1/email_drafts","sendQuery":true,"queryParameters":{"parameters":[{}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB2Y2tpaWNsZ3pkendjc3h0ZWtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1MjMyMTksImV4cCI6MjA2ODA5OTIxOX0.at2jET1WoXwOxjWx-ORAiu6qFsn9KW-bUMM4Tn64Qlw"},{"name":"Authorization","value":"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB2Y2tpaWNsZ3pkendjc3h0ZWtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1MjMyMTksImV4cCI6MjA2ODA5OTIxOX0.at2jET1WoXwOxjWx-ORAiu6qFsn9KW-bUMM4Tn64Qlw"},{"name":"Content-Type","value":"application/json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[47200,4864],"id":"779770c1-19f1-4273-9e72-8393766d80db","name":"Fetch senders from Supabase1","disabled":true},{"parameters":{"operation":"update","tableId":"email_drafts","filters":{"conditions":[{"keyName":"recipient","condition":"eq","keyValue":"={{ $('Switch2').item.json.recipient }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"delivered_status","fieldValue":"delivered"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[49952,4208],"id":"ede59cd2-af62-442e-966c-220d17344491","name":"Update Email Status3"},{"parameters":{"content":"## BD MANAGER DASHBOARD APPROVALS VALA","height":320,"width":528},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[46912,4752],"id":"cab03ea7-24e1-4893-804e-4dc84b6182d0","name":"Sticky Note15"},{"parameters":{"operation":"getAll","limit":10,"filtersUI":{"values":{"filters":{"foldersToInclude":[]}}},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[48688,2560],"id":"34012a10-1c1e-4946-adc6-951c4c8e885e","name":"Get many messages3","webhookId":"374af418-78cb-4975-88c8-1a3997c387ec"},{"parameters":{"resource":"folder","operation":"get","folderId":{"__rl":true,"value":"AAMkADQ4ODUzZmIwLTBhZDMtNGU4Zi1iZGU2LWQzOGNjZDE2MDIyNQAuAAAAAAAqsVm2OXCsQKlnQI0U0DkHAQC9N3ccsoV-RrGfhK8JJhnVAAAAAAEMAAA=","mode":"list","cachedResultName":"Inbox","cachedResultUrl":"https://outlook.office365.com/mail/AAMkADQ4ODUzZmIwLTBhZDMtNGU4Zi1iZGU2LWQzOGNjZDE2MDIyNQAuAAAAAAAqsVm2OXCsQKlnQI0U0DkHAQC9N3ccsoV%2FRrGfhK8JJhnVAAAAAAEMAAA%3D"},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[48496,2560],"id":"489da6fb-2b75-4a62-b5a1-b00d119d5f0b","name":"Get a folder3","webhookId":"d5d04720-566b-4187-a94e-ae9b92880104"},{"parameters":{"resource":"folder","operation":"get","folderId":{"__rl":true,"value":"AAMkADQ4ODUzZmIwLTBhZDMtNGU4Zi1iZGU2LWQzOGNjZDE2MDIyNQAuAAAAAAAqsVm2OXCsQKlnQI0U0DkHAQC9N3ccsoV-RrGfhK8JJhnVAAAAAAEMAAA=","mode":"list","cachedResultName":"Inbox","cachedResultUrl":"https://outlook.office365.com/mail/AAMkADQ4ODUzZmIwLTBhZDMtNGU4Zi1iZGU2LWQzOGNjZDE2MDIyNQAuAAAAAAAqsVm2OXCsQKlnQI0U0DkHAQC9N3ccsoV%2FRrGfhK8JJhnVAAAAAAEMAAA%3D"},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[48480,3264],"id":"c1dbe32b-f9e5-486b-995b-651aadcebdcd","name":"Get a folder4","webhookId":"d5d04720-566b-4187-a94e-ae9b92880104"},{"parameters":{"operation":"getAll","filtersUI":{"values":{"filters":{"foldersToInclude":[]}}},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[48704,3264],"id":"75e5eee2-e5ed-48e1-bf53-b3dc90dd478c","name":"Get many messages4","webhookId":"374af418-78cb-4975-88c8-1a3997c387ec"},{"parameters":{"operation":"executeQuery","query":"SELECT id, recipient , sender_email\nFROM public.email_drafts\nWHERE replied IS NOT TRUE\nLIMIT 1 ;\n","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[47840,3248],"id":"e1f7de0c-59c9-4a13-9493-0992fe07a60b","name":"Get Unreplied emails1"},{"parameters":{"resource":"folder","operation":"get","folderId":{"__rl":true,"value":"AAMkADQ4ODUzZmIwLTBhZDMtNGU4Zi1iZGU2LWQzOGNjZDE2MDIyNQAuAAAAAAAqsVm2OXCsQKlnQI0U0DkHAQC9N3ccsoV-RrGfhK8JJhnVAAAAAAEMAAA=","mode":"list","cachedResultName":"Inbox","cachedResultUrl":"https://outlook.office365.com/mail/AAMkADQ4ODUzZmIwLTBhZDMtNGU4Zi1iZGU2LWQzOGNjZDE2MDIyNQAuAAAAAAAqsVm2OXCsQKlnQI0U0DkHAQC9N3ccsoV%2FRrGfhK8JJhnVAAAAAAEMAAA%3D"},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[48464,3952],"id":"089212d3-851d-4b46-8d2a-4d34064d8f68","name":"Get a folder5","webhookId":"d5d04720-566b-4187-a94e-ae9b92880104"},{"parameters":{"operation":"getAll","filtersUI":{"values":{"filters":{"foldersToInclude":[]}}},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[48656,3936],"id":"e3325bab-1e39-4cfb-9fcc-1d8cac13b987","name":"Get many messages5","webhookId":"374af418-78cb-4975-88c8-1a3997c387ec"},{"parameters":{"assignments":{"assignments":[{"id":"71c05052-a399-42e1-a493-3085aa7f26d1","name":"subject","value":"={{ $json.subject }}","type":"string"},{"id":"14a37df6-9581-4603-a9f1-5ce8f8248a8d","name":"body_text","value":"={{ $json.body.content }}","type":"string"},{"id":"0a1b48c6-025d-4ca0-802b-67089989f7bc","name":"to_emails","value":"={{ $json.toRecipients[0].emailAddress.address }}","type":"string"},{"id":"047c2f53-6c5d-4386-bdcd-184c3af65bb7","name":"from_email","value":"={{ $json.from.emailAddress.address }}","type":"string"},{"id":"b7c6728c-61ee-44c3-bd03-2b8015ac9a75","name":"from_name","value":"={{ $json.from.emailAddress.name }}","type":"string"},{"id":"b91a5ac5-5bca-4223-ab4c-a911c8d15297","name":"id","value":"={{ $json.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[49312,4400],"id":"f0516083-e6d8-4067-9c8d-7ae7575e013f","name":"Edit Fields10"},{"parameters":{"operation":"update","tableId":"email_drafts","filters":{"conditions":[{"keyName":"id","condition":"eq","keyValue":"={{ $json.id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"status","fieldValue":"sent"},{"fieldId":"delivered_status","fieldValue":"delivered"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[49664,4400],"id":"80555d3d-915c-4eb3-867f-479a7af74027","name":"Update a row3","credentials":{"supabaseApi":{"id":"Yw4wgkIKcwecx5YL","name":"Supabase account"}}},{"parameters":{"url":"=https://graph.microsoft.com/v1.0/me/messages/{{ $('Loop Over Items13').item.json.outlook_draft_id }}?$select=subject,body,toRecipients,ccRecipients,bccRecipients,replyTo,sender,from&$expand=attachments\n","authentication":"genericCredentialType","genericAuthType":"oAuth2Api","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[49168,4400],"id":"f3217740-fb00-496a-8f31-96149648ad62","name":"Get Message Metadata3"},{"parameters":{"operation":"getAll","tableId":"email_drafts","limit":1,"filters":{"conditions":[{"keyName":"status","condition":"eq","keyValue":"draft"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[49680,6496],"id":"b86f45fc-664f-4e82-8221-4cc8f7018c6d","name":"Fetch status=draft Rows1","credentials":{"supabaseApi":{"id":"Yw4wgkIKcwecx5YL","name":"Supabase account"}}},{"parameters":{"jsCode":"items.sort((a, b) => new Date(a.json.created_at) - new Date(b.json.created_at));\nreturn [items[0]];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[49920,6528],"id":"783ba75a-540d-4e17-a00a-e50ff7264d1a","name":"Sort in asc ( Created date )1"},{"parameters":{"assignments":{"assignments":[{"id":"17da43d1-1b53-4484-ae3d-f1c8858888c7","name":"subject","value":"={{ $json.subject }}","type":"string"},{"id":"99bd63a2-c039-4fed-8dd8-cbec8d7d926c","name":"body","value":"={{ $('Create a draft1').item.json.body.content }}","type":"string"},{"id":"fbdd858a-fad6-4430-a3e6-eb4c7a62e1db","name":"recipient","value":"={{ $json.recipient }}","type":"string"},{"id":"022c240a-b58b-4bdc-854d-4be9f1e129ce","name":"sender_email","value":"={{ $json.sender_email }}","type":"string"},{"id":"723876e3-8cc2-4a38-ab00-8b4eb15f4602","name":"message_id","value":"={{ $json.message_id }}","type":"string"},{"id":"23be1d89-5be4-4824-adb9-7f6e56a5cb42","name":"outlook_draft_id","value":"={{ $json.outlook_draft_id }}","type":"string"},{"id":"5663d628-0f65-4528-805a-4853aac0c361","name":"id","value":"={{ $json.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[50128,6528],"id":"a8d7923f-4c12-4f50-9ed9-f6fd8f8d6283","name":"Edit Fields11"},{"parameters":{"resource":"draft","operation":"get","draftId":{"__rl":true,"value":"={{ $json.outlook_draft_id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[48768,4400],"id":"1ff145c6-2e3a-4047-86e6-7bfc5e9b2da3","name":"Get a draft3","webhookId":"d3b8722f-192d-4640-b73d-f928e874ca07"},{"parameters":{"toRecipients":"={{ $json.to[0] }}","subject":"={{ $json[\"subject\"] }}","bodyContent":"={{ $json.bodyPreview }}\n","additionalFields":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[48960,4400],"id":"def93025-8851-4492-92b2-0b8075bbc0cd","name":"Send a message3","webhookId":"6e023a48-58f8-44cf-8236-d327d5d9e3e7","disabled":true},{"parameters":{"contextWindowLength":20},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[47088,6640],"id":"52e5afde-abc7-4d6f-bf3b-2055feed5f18","name":"Simple Memory2"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[48240,4352],"id":"e4822a5b-b50a-4b03-808d-9e73f0aa27f4","name":"Loop Over Items13"},{"parameters":{"amount":15},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[49984,4400],"id":"6e6fde70-336c-4084-82eb-21958c4c317c","name":"Wait13","webhookId":"c4cf719a-d47f-4761-8a16-aff92b8e9a19"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[48240,3248],"id":"d2540896-f959-4db4-a858-aac0b1c69ab8","name":"Loop Over Items14"},{"parameters":{"amount":15},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[49808,3216],"id":"07b48238-c3b0-44b5-bead-fe20c8e8f448","name":"Wait14","webhookId":"5fcbde9f-0750-405b-8ff7-8bce2e4a16ef"},{"parameters":{"jsCode":"// JavaScript code for n8n Code node to prepare HTML email for Gmail API\nconst emailData = {\n  messageId: $input.item.json['Message ID'],\n  threadId: $input.item.json['Thread ID'] || $input.item.json['Message ID'],\n  subject: $input.item.json['Email#1 Subject'],\n  senderEmail: $input.item.json['Sender Email'],\n  recipientEmail: $input.item.json['Email Address'],\n  token: $input.item.json['Token']\n};\n\n// Check available input keys to help diagnose the issue\nconst inputKeys = Object.keys($input.item.json);\nconsole.log('Available input keys:', inputKeys);\n\n// Try to find the email body in different possible formats\nlet emailBodyContent = '';\n// First try the exact key name\nif ($input.item.json['Email#2 Body'] !== undefined) {\n  emailBodyContent = $input.item.json['Email#2 Body'];\n} \n// Try with a space after the hash\nelse if ($input.item.json['Email #2 Body'] !== undefined) {\n  emailBodyContent = $input.item.json['Email #2 Body'];\n} \n// Try other possible variations\nelse if ($input.item.json['EmailBody'] !== undefined) {\n  emailBodyContent = $input.item.json['EmailBody'];\n} \n// Default fallback message if none found\nelse {\n  emailBodyContent = \"Thank you for your attention to this matter.\";\n  console.log(\"No email body found, using default text\");\n}\n\n// Ensure message ID is properly formatted\nconst formattedMessageId = emailData.messageId.startsWith('<') ? \n  emailData.messageId : \n  `<${emailData.messageId}>`;\n\n// Create HTML email body with unsubscribe link\nconst htmlBody = `${emailBodyContent}<br><br>\n<a href=\"https://kiaghasem.app.n8n.cloud/webhook/unsubscribe?tkn=${emailData.token}\">Click Here to Unsubscribe</a>`;\n\n// Create email in RFC 2822 format with HTML content type\nconst emailContent = \n  `In-Reply-To: ${formattedMessageId}\\n` +\n  `References: ${formattedMessageId}\\n` +\n  `Subject: Re: ${emailData.subject}\\n` +\n  `From: ${emailData.senderEmail}\\n` +\n  `To: ${emailData.recipientEmail}\\n` +\n  `Content-Type: text/html; charset=\"UTF-8\"\\n\\n` +\n  `${htmlBody}`;\n\n// Base64 encode and convert to base64url format\nconst base64EncodedEmail = Buffer.from(emailContent)\n  .toString('base64')\n  .replace(/\\+/g, '-')\n  .replace(/\\//g, '_')\n  .replace(/=+$/, '');\n\n// Return an object with the encoded email and thread ID\nreturn {\n  json: {\n    raw: base64EncodedEmail,\n    threadId: emailData.threadId\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[49440,3072],"id":"2a8fbc2f-5f97-4ea5-a6d3-9fe0af86fbc2","name":"Code13"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"177601be-b2c3-45cc-8e15-cd064fbaf578","leftValue":"={{ $('Edit Fields8').item.json.replied }}","rightValue":"Yes","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[49280,2544],"id":"e52dbfee-e38f-4169-be0a-3ee688fde215","name":"If13"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[48240,2544],"id":"27490ab3-52e8-490f-9d50-b2053a1ee5a0","name":"Loop Over Items15"},{"parameters":{"amount":15},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[50016,2528],"id":"3107e915-e523-4f30-bf90-ad9ec43aa9e7","name":"Wait15","webhookId":"5fcbde9f-0750-405b-8ff7-8bce2e4a16ef"},{"parameters":{"jsCode":"// JavaScript code for n8n Code node to prepare HTML email for Gmail API\nconst emailData = {\n  messageId: $input.item.json['Message ID'],\n  threadId: $input.item.json['Thread ID'] || $input.item.json['Message ID'],\n  subject: $input.item.json['Email#1 Subject'],\n  senderEmail: $input.item.json['Sender Email'],\n  recipientEmail: $input.item.json['Email Address'],\n  token: $input.item.json['Token']\n};\n\n// Check available input keys to help diagnose the issue\nconst inputKeys = Object.keys($input.item.json);\nconsole.log('Available input keys:', inputKeys);\n\n// Try to find the email body in different possible formats\nlet emailBodyContent = '';\n// First try the exact key name\nif ($input.item.json['Email#2 Body'] !== undefined) {\n  emailBodyContent = $input.item.json['Email#2 Body'];\n} \n// Try with a space after the hash\nelse if ($input.item.json['Email #2 Body'] !== undefined) {\n  emailBodyContent = $input.item.json['Email #2 Body'];\n} \n// Try other possible variations\nelse if ($input.item.json['EmailBody'] !== undefined) {\n  emailBodyContent = $input.item.json['EmailBody'];\n} \n// Default fallback message if none found\nelse {\n  emailBodyContent = \"Thank you for your attention to this matter.\";\n  console.log(\"No email body found, using default text\");\n}\n\n// Ensure message ID is properly formatted\nconst formattedMessageId = emailData.messageId.startsWith('<') ? \n  emailData.messageId : \n  `<${emailData.messageId}>`;\n\n// Create HTML email body with unsubscribe link\nconst htmlBody = `${emailBodyContent}<br><br>\n<a href=\"https://kiaghasem.app.n8n.cloud/webhook/unsubscribe?tkn=${emailData.token}\">Click Here to Unsubscribe</a>`;\n\n// Create email in RFC 2822 format with HTML content type\nconst emailContent = \n  `In-Reply-To: ${formattedMessageId}\\n` +\n  `References: ${formattedMessageId}\\n` +\n  `Subject: Re: ${emailData.subject}\\n` +\n  `From: ${emailData.senderEmail}\\n` +\n  `To: ${emailData.recipientEmail}\\n` +\n  `Content-Type: text/html; charset=\"UTF-8\"\\n\\n` +\n  `${htmlBody}`;\n\n// Base64 encode and convert to base64url format\nconst base64EncodedEmail = Buffer.from(emailContent)\n  .toString('base64')\n  .replace(/\\+/g, '-')\n  .replace(/\\//g, '_')\n  .replace(/=+$/, '');\n\n// Return an object with the encoded email and thread ID\nreturn {\n  json: {\n    raw: base64EncodedEmail,\n    threadId: emailData.threadId\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[49568,2352],"id":"2946c50a-09df-4407-8bed-e11d14422df8","name":"Code14"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"177601be-b2c3-45cc-8e15-cd064fbaf578","leftValue":"={{ $json.replied }}","rightValue":"Yes","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[49136,3840],"id":"fac35e85-9104-4c7d-bc35-18d6d36a54ae","name":"If14"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[48240,3936],"id":"ee451f49-ad17-4ba0-a289-b0ee2174bc54","name":"Loop Over Items16"},{"parameters":{"amount":15},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[49808,3920],"id":"aeb5b75e-c8ef-4c2a-a17c-ce2e6ebbfe13","name":"Wait16","webhookId":"5fcbde9f-0750-405b-8ff7-8bce2e4a16ef"},{"parameters":{"method":"POST","url":"https://www.googleapis.com/gmail/v1/users/me/messages/send","authentication":"predefinedCredentialType","nodeCredentialType":"gmailOAuth2","sendBody":true,"bodyParameters":{"parameters":[{"name":"raw","value":"={{ $json.raw }}"},{"name":"=threadId","value":"={{ $json.threadId }}"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[49584,3680],"id":"4c814d27-b5f2-42c2-98b5-d9d3137f9722","name":"HTTP Request1"},{"parameters":{"content":"## WORKFLOW 3 \n\n## ONCE REPLY IS RECEIVED - IT DRAFTS A REPLY MAIL \n\n## WAITS FOR BD MANAGER APPROVAL \n","height":2000,"width":3296,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[47024,2176],"id":"91baaba0-b38e-4fc5-a816-a94eea00a7c7","name":"Sticky Note16"},{"parameters":{"content":"## WORKFLOW 2 \n\n## TRIGGERED ONCE APPROVAL IS RECEIVED BY BD MANAGER \n\n## SEND MAILS TO APPOVED ONES","height":1456,"width":2912,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[47344,4192],"id":"f6d4cdc4-f5b5-4455-9284-d103db13a94c","name":"Sticky Note17"},{"parameters":{"jsCode":"// Get the string from input (AI Agent output)\nconst raw = $json.output;\n\n// Parse the string into JSON\nconst parsed = JSON.parse(raw);\n\n// Return each item as its own item\nreturn parsed.map(item => ({ json: item }));\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[47520,6416],"id":"66ade84a-519e-49ed-b5f5-a92a646e6f40","name":"Code15"},{"parameters":{"content":"## WORKFLOW 1 \n\n## IDENTIFIES POTENTIAL PROJECTS \n\n## DRAFTS OUTLOOK MAIL IN PROPER FORMAT","height":960,"width":3408,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[46576,6144],"id":"bf8bbf96-c8eb-4568-8e42-a66057f7e99a","name":"Sticky Note18"},{"parameters":{"content":"## PERSONALISATION + PAIN-POINTS + HOW SES CAN HELP ?","height":608,"width":406},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[47696,6144],"id":"293808ff-8089-4708-a2ab-319e3feed8c5","name":"Sticky Note19"},{"parameters":{"content":"## FORMATS AND DRAFTS COLD PERSONALISED MAILS","height":560,"width":1472,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[48192,6160],"id":"61b5b060-9391-4c4e-8004-cf551a978ddd","name":"Sticky Note20"},{"parameters":{"tableId":"email_drafts","fieldsUi":{"fieldValues":[{"fieldId":"recipient","fieldValue":"={{ $json.to_emails }}"},{"fieldId":"sender_email","fieldValue":"={{ $json.from_email }}"},{"fieldId":"subject","fieldValue":"={{ $json.subject }}"},{"fieldId":"body","fieldValue":"={{ $json.body_text }}"},{"fieldId":"status","fieldValue":"sent"},{"fieldId":"delivered_status","fieldValue":"delivered"},{"fieldId":"message_id","fieldValue":"={{ $json.id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[49488,4400],"id":"0186edd8-ee33-4700-9d6c-8bc07eb17c72","name":"Create a row3","credentials":{"supabaseApi":{"id":"Yw4wgkIKcwecx5YL","name":"Supabase account"}}},{"parameters":{"operation":"update","tableId":"email_drafts","filters":{"conditions":[{"keyName":"recipient","condition":"eq","keyValue":"={{ $('Switch2').item.json.recipient }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"delivered_status","fieldValue":"delivered"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[49952,4656],"id":"765b0b0a-5cb9-4d5a-b9db-9fefcdb5e864","name":"Update Email Status4"},{"parameters":{"toRecipients":"={{ $json.to[0] }}","subject":"={{ $json[\"subject\"] }}","bodyContent":"={{ $json.bodyPreview }}\n","additionalFields":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[48960,4848],"id":"74aad331-b80c-4a4a-a8d5-ecf34a2afb2b","name":"Send a message4","webhookId":"6e023a48-58f8-44cf-8236-d327d5d9e3e7","disabled":true},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[48240,4800],"id":"d8c5cd29-d89a-482c-bcbe-1dd05141d983","name":"Loop Over Items17"},{"parameters":{"amount":15},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[49984,4848],"id":"dbb5493b-ce03-4209-acc8-eedc2e0e1c11","name":"Wait17","webhookId":"c4cf719a-d47f-4761-8a16-aff92b8e9a19"},{"parameters":{"tableId":"email_drafts","fieldsUi":{"fieldValues":[{"fieldId":"recipient","fieldValue":"={{ $json.to_emails }}"},{"fieldId":"sender_email","fieldValue":"={{ $json.from_email }}"},{"fieldId":"subject","fieldValue":"={{ $json.subject }}"},{"fieldId":"body","fieldValue":"={{ $json.body_text }}"},{"fieldId":"status","fieldValue":"sent"},{"fieldId":"delivered_status","fieldValue":"delivered"},{"fieldId":"message_id","fieldValue":"={{ $json.id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[49552,4768],"id":"a128a67f-14c3-4042-b405-1f0884dbd617","name":"Create a row4"},{"parameters":{"operation":"update","tableId":"email_drafts","filters":{"conditions":[{"keyName":"recipient","condition":"eq","keyValue":"={{ $('Switch2').item.json.recipient }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"delivered_status","fieldValue":"delivered"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[49984,5152],"id":"f7e1e3c4-895f-40c0-bf3a-3336204e3e8b","name":"Update Email Status5"},{"parameters":{"assignments":{"assignments":[{"id":"71c05052-a399-42e1-a493-3085aa7f26d1","name":"subject","value":"={{ $json.subject }}","type":"string"},{"id":"14a37df6-9581-4603-a9f1-5ce8f8248a8d","name":"body_text","value":"={{ $json.body.content }}","type":"string"},{"id":"0a1b48c6-025d-4ca0-802b-67089989f7bc","name":"to_emails","value":"={{ $json.toRecipients[0].emailAddress.address }}","type":"string"},{"id":"047c2f53-6c5d-4386-bdcd-184c3af65bb7","name":"from_email","value":"={{ $json.from.emailAddress.address }}","type":"string"},{"id":"b7c6728c-61ee-44c3-bd03-2b8015ac9a75","name":"from_name","value":"={{ $json.from.emailAddress.name }}","type":"string"},{"id":"b91a5ac5-5bca-4223-ab4c-a911c8d15297","name":"id","value":"={{ $json.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[49392,5296],"id":"64402764-405e-4b28-9625-8bb91eeaf9db","name":"Edit Fields12"},{"parameters":{"toRecipients":"={{ $json.to[0] }}","subject":"={{ $json[\"subject\"] }}","bodyContent":"={{ $json.bodyPreview }}\n","additionalFields":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[48992,5344],"id":"24294346-cd62-48f2-8348-63787c2f84af","name":"Send a message5","webhookId":"6e023a48-58f8-44cf-8236-d327d5d9e3e7","disabled":true},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[48272,5296],"id":"fb340abf-7f33-4a25-b501-e7436f6bd3ec","name":"Loop Over Items18"},{"parameters":{"amount":15},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[50016,5344],"id":"009b49a9-e4e8-4f08-9e0a-fd7cde5ff455","name":"Wait18","webhookId":"c4cf719a-d47f-4761-8a16-aff92b8e9a19"}],"connections":{"Structured Output Parser":{"ai_outputParser":[[{"node":"global_search","type":"ai_outputParser","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"global_search","type":"ai_languageModel","index":0}]]},"global_search":{"main":[[{"node":"Code","type":"main","index":0}]]},"Loop Over Items":{"main":[[{"node":"Wait7","type":"main","index":0}],[{"node":"Scrape single URL","type":"main","index":0}]]},"Code":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"get_categories":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"http_status_code":{"main":[[{"node":"If4","type":"main","index":0}]]},"checking_duplicate_row":{"main":[[{"node":"Code4","type":"main","index":0}]]},"Create a new row":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Loop Over Items1":{"main":[[],[{"node":"global_search","type":"main","index":0}]]},"Google Gemini Chat Model1":{"ai_languageModel":[[{"node":"Structured Output Parser","type":"ai_languageModel","index":0}]]},"get-keywords":{"ai_tool":[[{"node":"gen_search-url","type":"ai_tool","index":0}]]},"get_target_companies":{"ai_tool":[[{"node":"gen_search-url","type":"ai_tool","index":0}]]},"get_source_links":{"main":[[{"node":"Code2","type":"main","index":0}]]},"Loop Over Items2":{"main":[[],[{"node":"gen_search-url","type":"main","index":0}]]},"Google Gemini Chat Model2":{"ai_languageModel":[[{"node":"gen_search-url","type":"ai_languageModel","index":0}]]},"gen_search-url":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"Loop Over Items3","type":"main","index":0}]]},"Loop Over Items3":{"main":[[{"node":"Wait2","type":"main","index":0}],[{"node":"Scrape single URL1","type":"main","index":0}]]},"If2":{"main":[[{"node":"Loop Over Items3","type":"main","index":0}],[{"node":"url-to-html","type":"main","index":0}]]},"When clicking ‚ÄòExecute workflow‚Äô":{"main":[[{"node":"get_categories","type":"main","index":0}]]},"url-to-html":{"main":[[{"node":"Article Information Extractor","type":"main","index":0}]]},"Google Gemini Chat Model3":{"ai_languageModel":[[{"node":"Article Information Extractor","type":"ai_languageModel","index":0}]]},"Article Information Extractor":{"main":[[{"node":"article_data_formatting","type":"main","index":0}]]},"article_data_formatting":{"main":[[{"node":"date_filter","type":"main","index":0}]]},"Loop Over Items4":{"main":[[{"node":"Wait5","type":"main","index":0}],[{"node":"Get a row1","type":"main","index":0}]]},"Google Gemini Chat Model4":{"ai_languageModel":[[{"node":"AI Agent article_link_filter","type":"ai_languageModel","index":0}]]},"AI Agent article_link_filter":{"main":[[{"node":"If3","type":"main","index":0}]]},"If3":{"main":[[{"node":"Create a row","type":"main","index":0}],[{"node":"Loop Over Items4","type":"main","index":0}]]},"Create a row":{"main":[[{"node":"Wait4","type":"main","index":0}]]},"Loop Over Items5":{"main":[[],[{"node":"If6","type":"main","index":0}]]},"article-url-to-html":{"main":[[{"node":"extracting-article-content","type":"main","index":0}]]},"Google Gemini Chat Model5":{"ai_languageModel":[[{"node":"extracting-article-content","type":"ai_languageModel","index":0}]]},"extracting-article-content":{"main":[[{"node":"date_filter1","type":"main","index":0}]]},"Wait3":{"main":[[{"node":"Article-analyser-SES","type":"main","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"Article-analyser-SES","type":"ai_memory","index":0}]]},"Structured Output Parser1":{"ai_outputParser":[[{"node":"Article-analyser-SES","type":"ai_outputParser","index":0}]]},"Article-analyser-SES":{"main":[[{"node":"If5","type":"main","index":0}]]},"If5":{"main":[[{"node":"Create a row in final-table","type":"main","index":0}],[{"node":"Wait6","type":"main","index":0}]]},"Wait4":{"main":[[{"node":"Loop Over Items4","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Structured Output Parser1","type":"ai_languageModel","index":0}]]},"date_filter":{"main":[[{"node":"Loop Over Items4","type":"main","index":0}]]},"Google Gemini Chat Model6":{"ai_languageModel":[[{"node":"Article-analyser-SES","type":"ai_languageModel","index":0}]]},"If6":{"main":[[{"node":"article-url-to-html","type":"main","index":0}],[{"node":"Loop Over Items5","type":"main","index":0}]]},"get_article_links_from-raw-article-table":{"main":[[{"node":"Loop Over Items5","type":"main","index":0}]]},"Create a row in final-table":{"main":[[{"node":"Update row in raw_article_table_status","type":"main","index":0}]]},"Update row in raw_article_table_status":{"main":[[{"node":"Wait6","type":"main","index":0}]]},"Wait5":{"main":[[{"node":"Loop Over Items3","type":"main","index":0}]]},"Wait2":{"main":[[{"node":"Loop Over Items2","type":"main","index":0}]]},"Get a row1":{"main":[[{"node":"Code3","type":"main","index":0}]]},"Code3":{"main":[[{"node":"If7","type":"main","index":0}]]},"If7":{"main":[[{"node":"AI Agent article_link_filter","type":"main","index":0}],[{"node":"Loop Over Items4","type":"main","index":0}]]},"date_filter1":{"main":[[{"node":"Wait3","type":"main","index":0}]]},"Wait6":{"main":[[{"node":"Loop Over Items5","type":"main","index":0}]]},"If4":{"main":[[{"node":"checking_duplicate_row","type":"main","index":0}],[{"node":"Wait","type":"main","index":0}]]},"Wait":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Code4":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Create a new row","type":"main","index":0}],[{"node":"Wait","type":"main","index":0}]]},"Wait7":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Loop Over Items2","type":"main","index":0}]]},"Scrape single URL":{"main":[[{"node":"http_status_code","type":"main","index":0}]]},"Scrape single URL1":{"main":[[{"node":"If2","type":"main","index":0}]]},"Split Out1":{"main":[[{"node":"If8","type":"main","index":0}]]},"HTTP Request6":{"main":[[{"node":"Split Out1","type":"main","index":0}]]},"Get dataset items":{"main":[[{"node":"Extract Info1","type":"main","index":0}]]},"Run an Actor":{"main":[[{"node":"If10","type":"main","index":0}]]},"Enrich Company Agent":{"main":[[{"node":"Code7","type":"main","index":0}]]},"Validation agent":{"main":[[{"node":"Code8","type":"main","index":0}]]},"Extract Info1":{"main":[[{"node":"Insert Company Research1","type":"main","index":0}]]},"Insert Leads to Master":{"main":[[{"node":"Mark Insight Processed","type":"main","index":0}]]},"Filter High-Confidence Insights":{"main":[[{"node":"Enrich Company Agent","type":"main","index":0}],[{"node":"Mark Insight Processed","type":"main","index":0}]]},"Log Validation Results":{"main":[[{"node":"Filter High-Confidence Insights","type":"main","index":0}]]},"Validate Required Fields":{"main":[[{"node":"Split Out2","type":"main","index":0}]]},"Fetch New Opportunities":{"main":[[{"node":"Validate Required Fields","type":"main","index":0}]]},"Daily Trigger":{"main":[[{"node":"Fetch New Opportunities","type":"main","index":0}]]},"Split Out2":{"main":[[{"node":"Loop Over Items6","type":"main","index":0}]]},"Mark Insight Processed":{"main":[[{"node":"Loop Over Items6","type":"main","index":0}]]},"Insert Company Research1":{"main":[[{"node":"Insert Leads to Master","type":"main","index":0}]]},"Loop Over Items6":{"main":[[],[{"node":"Validation agent","type":"main","index":0}]]},"If8":{"main":[[{"node":"Code5","type":"main","index":0}]]},"Code5":{"main":[[{"node":"Run an Actor","type":"main","index":0}]]},"Code7":{"main":[[{"node":"HTTP Request6","type":"main","index":0}]]},"Code8":{"main":[[{"node":"Log Validation Results","type":"main","index":0}]]},"If10":{"main":[[{"node":"Get dataset items","type":"main","index":0}],[{"node":"Stop and Error","type":"main","index":0}]]},"When chat message received":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Select rows from a table in Postgres":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Email #1 #2 #3":{"main":[[{"node":"Emails","type":"main","index":0}]]},"Emails":{"main":[[{"node":"Time Zone","type":"main","index":0}]]},"Time Zone":{"main":[[{"node":"Sender Email","type":"main","index":0}]]},"Sender Email":{"main":[[{"node":"Opt Out Token","type":"main","index":0}]]},"Opt Out Token":{"main":[[{"node":"Create a draft","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"Code11","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Loop Over Items7","type":"main","index":0}],[{"node":"Loop Over Items8","type":"main","index":0}],[{"node":"Loop Over Items9","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"Loop Over Items8","type":"main","index":0}]]},"Schedule Trigger1":{"main":[[{"node":"Fetch senders from Supabase","type":"main","index":0}]]},"Switch1":{"main":[[{"node":"Loop Over Items11","type":"main","index":0}],[{"node":"Loop Over Items10","type":"main","index":0}],[{"node":"Loop Over Items12","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Merge1","type":"main","index":1}]]},"If1":{"main":[[{"node":"Replied = Yes1","type":"main","index":0}],[{"node":"Code9","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"If1","type":"main","index":0}]]},"HTTP Request3":{"main":[[{"node":"Wait10","type":"main","index":0}]]},"Replied = Yes1":{"main":[[{"node":"Loop Over Items10","type":"main","index":0}]]},"Edit Fields2":{"main":[[{"node":"If9","type":"main","index":0}]]},"Replied = Yes2":{"main":[[{"node":"Loop Over Items11","type":"main","index":0}]]},"HTTP Request4":{"main":[[{"node":"Wait11","type":"main","index":0}]]},"Edit Fields3":{"main":[[{"node":"Merge3","type":"main","index":1}]]},"Merge3":{"main":[[{"node":"If11","type":"main","index":0}]]},"Replied = Yes3":{"main":[[{"node":"Loop Over Items12","type":"main","index":0}]]},"Code6":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Create a draft":{"main":[[{"node":"Insert to Supabase","type":"main","index":0}]]},"Analyze":{"main":[[{"node":"Email #1 #2 #3","type":"main","index":0}]]},"Insert to Supabase":{"main":[[{"node":"Fetch status=draft Rows","type":"main","index":0}]]},"Send a message1":{"main":[[{"node":"Wait1","type":"main","index":0}]]},"Send a message2":{"main":[[{"node":"Wait9","type":"main","index":0}]]},"Get many messages":{"main":[[{"node":"Edit Fields2","type":"main","index":0}]]},"Get a folder":{"main":[[{"node":"Get many messages","type":"main","index":0}]]},"Get a folder1":{"main":[[{"node":"Get many messages1","type":"main","index":0}]]},"Get many messages1":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Get Unreplied emails":{"main":[[{"node":"Switch1","type":"main","index":0}]]},"Get a folder2":{"main":[[{"node":"Get many messages2","type":"main","index":0}]]},"Get many messages2":{"main":[[{"node":"Edit Fields3","type":"main","index":0}]]},"Edit Fields5":{"main":[[{"node":"Create a row1","type":"main","index":0}]]},"Update a row":{"main":[[{"node":"Wait8","type":"main","index":0}]]},"Get Message Metadata":{"main":[[{"node":"Edit Fields5","type":"main","index":0}]]},"Fetch status=draft Rows":{"main":[[{"node":"Sort in asc ( Created date )","type":"main","index":0}]]},"Sort in asc ( Created date )":{"main":[[{"node":"Edit Fields6","type":"main","index":0}]]},"Edit Fields6":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Get a draft":{"main":[[{"node":"Send a message","type":"main","index":0}]]},"Send a message":{"main":[[{"node":"Get Message Metadata","type":"main","index":0}]]},"Simple Memory1":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Loop Over Items7":{"main":[[{"node":"Update Email Status","type":"main","index":0}],[{"node":"Get a draft","type":"main","index":0}]]},"Wait8":{"main":[[{"node":"Loop Over Items7","type":"main","index":0}]]},"Loop Over Items8":{"main":[[{"node":"Update Email Status1","type":"main","index":0}],[{"node":"Send a message1","type":"main","index":0}]]},"Loop Over Items9":{"main":[[{"node":"Update Email Status2","type":"main","index":0}],[{"node":"Send a message2","type":"main","index":0}]]},"Wait9":{"main":[[{"node":"Loop Over Items9","type":"main","index":0}]]},"Loop Over Items10":{"main":[[],[{"node":"Merge1","type":"main","index":0},{"node":"Get a folder1","type":"main","index":0}]]},"Wait10":{"main":[[{"node":"Loop Over Items10","type":"main","index":0}]]},"Code9":{"main":[[{"node":"HTTP Request3","type":"main","index":0}]]},"If9":{"main":[[{"node":"Replied = Yes2","type":"main","index":0}],[{"node":"Code10","type":"main","index":0}]]},"Loop Over Items11":{"main":[[],[{"node":"Get a folder","type":"main","index":0}]]},"Wait11":{"main":[[{"node":"Loop Over Items11","type":"main","index":0}]]},"Code10":{"main":[[{"node":"HTTP Request4","type":"main","index":0}]]},"If11":{"main":[[{"node":"Replied = Yes3","type":"main","index":0}],[{"node":"Code6","type":"main","index":0}]]},"Loop Over Items12":{"main":[[],[{"node":"Merge3","type":"main","index":0},{"node":"Get a folder2","type":"main","index":0}]]},"Wait12":{"main":[[{"node":"Loop Over Items12","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Wait12","type":"main","index":0}]]},"Code11":{"main":[[{"node":"Analyze","type":"main","index":0}]]},"Create a row1":{"main":[[{"node":"Update a row","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Create a row4","type":"main","index":0}]]},"Update a row1":{"main":[[{"node":"Wait17","type":"main","index":0}]]},"Get Message Metadata1":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Get a draft1":{"main":[[{"node":"Send a message4","type":"main","index":0}]]},"Update a row2":{"main":[[{"node":"Wait18","type":"main","index":0}]]},"Get Message Metadata2":{"main":[[{"node":"Edit Fields12","type":"main","index":0}]]},"Get a draft2":{"main":[[{"node":"Send a message5","type":"main","index":0}]]},"Create a row2":{"main":[[{"node":"Update a row2","type":"main","index":0}]]},"AI Agent1":{"main":[[{"node":"Code15","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"AI Agent1","type":"ai_languageModel","index":0}]]},"Select rows from a table in Postgres1":{"ai_tool":[[{"node":"AI Agent1","type":"ai_tool","index":0}]]},"Email #1 #2 #":{"main":[[{"node":"Emails1","type":"main","index":0}]]},"Emails1":{"main":[[{"node":"Time Zone1","type":"main","index":0}]]},"Time Zone1":{"main":[[{"node":"Sender Email1","type":"main","index":0}]]},"Sender Email1":{"main":[[{"node":"Opt Out Token1","type":"main","index":0}]]},"Opt Out Token1":{"main":[[{"node":"Create a draft1","type":"main","index":0}]]},"Switch2":{"main":[[{"node":"Loop Over Items13","type":"main","index":0}],[{"node":"Loop Over Items17","type":"main","index":0}],[{"node":"Loop Over Items18","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Fetch senders from Supabase1","type":"main","index":0}]]},"Switch3":{"main":[[{"node":"Loop Over Items15","type":"main","index":0}],[{"node":"Loop Over Items14","type":"main","index":0}],[{"node":"Loop Over Items16","type":"main","index":0}]]},"Edit Fields4":{"main":[[{"node":"Merge","type":"main","index":1}]]},"If12":{"main":[[{"node":"Replied = Yes","type":"main","index":0}],[{"node":"Code13","type":"main","index":0}]]},"Merge":{"main":[[{"node":"If12","type":"main","index":0}]]},"Replied = Yes":{"main":[[{"node":"Loop Over Items14","type":"main","index":0}]]},"HTTP Request5":{"main":[[{"node":"Wait14","type":"main","index":0}]]},"Edit Fields8":{"main":[[{"node":"Merge4","type":"main","index":1}]]},"Replied = Yes4":{"main":[[{"node":"Loop Over Items15","type":"main","index":0}]]},"HTTP Request7":{"main":[[{"node":"Wait15","type":"main","index":0}]]},"Edit Fields9":{"main":[[{"node":"Merge5","type":"main","index":1}]]},"Merge5":{"main":[[{"node":"If14","type":"main","index":0}]]},"Replied = Yes5":{"main":[[{"node":"Loop Over Items16","type":"main","index":0}]]},"Code12":{"main":[[{"node":"HTTP Request1","type":"main","index":0}]]},"Create a draft1":{"main":[[{"node":"Insert to Supabase1","type":"main","index":0}]]},"Insert to Supabase1":{"main":[[{"node":"Fetch status=draft Rows1","type":"main","index":0}]]},"Analyze1":{"main":[[{"node":"Email #1 #2 #","type":"main","index":0}]]},"Get many messages3":{"main":[[{"node":"Edit Fields8","type":"main","index":0}]]},"Get a folder3":{"main":[[{"node":"Get many messages3","type":"main","index":0}]]},"Get a folder4":{"main":[[{"node":"Get many messages4","type":"main","index":0}]]},"Get many messages4":{"main":[[{"node":"Edit Fields4","type":"main","index":0}]]},"Get Unreplied emails1":{"main":[[{"node":"Switch3","type":"main","index":0}]]},"Get a folder5":{"main":[[{"node":"Get many messages5","type":"main","index":0}]]},"Get many messages5":{"main":[[{"node":"Edit Fields9","type":"main","index":0}]]},"Edit Fields10":{"main":[[{"node":"Create a row3","type":"main","index":0}]]},"Update a row3":{"main":[[{"node":"Wait13","type":"main","index":0}]]},"Get Message Metadata3":{"main":[[{"node":"Edit Fields10","type":"main","index":0}]]},"Fetch status=draft Rows1":{"main":[[{"node":"Sort in asc ( Created date )1","type":"main","index":0}]]},"Sort in asc ( Created date )1":{"main":[[{"node":"Edit Fields11","type":"main","index":0}]]},"Edit Fields11":{"main":[[{"node":"Switch2","type":"main","index":0}]]},"Get a draft3":{"main":[[{"node":"Send a message3","type":"main","index":0}]]},"Send a message3":{"main":[[{"node":"Get Message Metadata3","type":"main","index":0}]]},"Simple Memory2":{"ai_memory":[[{"node":"AI Agent1","type":"ai_memory","index":0}]]},"Loop Over Items13":{"main":[[{"node":"Update Email Status3","type":"main","index":0}],[{"node":"Get a draft3","type":"main","index":0}]]},"Wait13":{"main":[[{"node":"Loop Over Items13","type":"main","index":0}]]},"Loop Over Items14":{"main":[[],[{"node":"Merge","type":"main","index":0},{"node":"Get a folder4","type":"main","index":0}]]},"Wait14":{"main":[[{"node":"Loop Over Items14","type":"main","index":0}]]},"Code13":{"main":[[{"node":"HTTP Request5","type":"main","index":0}]]},"If13":{"main":[[{"node":"Replied = Yes4","type":"main","index":0}],[{"node":"Code14","type":"main","index":0}]]},"Loop Over Items15":{"main":[[],[{"node":"Get a folder3","type":"main","index":0},{"node":"Merge4","type":"main","index":0}]]},"Wait15":{"main":[[{"node":"Loop Over Items15","type":"main","index":0}]]},"Code14":{"main":[[{"node":"HTTP Request7","type":"main","index":0}]]},"If14":{"main":[[{"node":"Replied = Yes5","type":"main","index":0}],[{"node":"Code12","type":"main","index":0}]]},"Loop Over Items16":{"main":[[],[{"node":"Merge5","type":"main","index":0},{"node":"Get a folder5","type":"main","index":0}]]},"Wait16":{"main":[[{"node":"Loop Over Items16","type":"main","index":0}]]},"HTTP Request1":{"main":[[{"node":"Wait16","type":"main","index":0}]]},"Code15":{"main":[[{"node":"Analyze1","type":"main","index":0}]]},"Create a row3":{"main":[[{"node":"Update a row3","type":"main","index":0}]]},"Send a message4":{"main":[[{"node":"Get Message Metadata1","type":"main","index":0}]]},"Loop Over Items17":{"main":[[{"node":"Update Email Status4","type":"main","index":0}],[{"node":"Get a draft1","type":"main","index":0}]]},"Wait17":{"main":[[{"node":"Loop Over Items17","type":"main","index":0}]]},"Create a row4":{"main":[[{"node":"Update a row1","type":"main","index":0}]]},"Edit Fields12":{"main":[[{"node":"Create a row2","type":"main","index":0}]]},"Send a message5":{"main":[[{"node":"Get Message Metadata2","type":"main","index":0}]]},"Loop Over Items18":{"main":[[{"node":"Update Email Status5","type":"main","index":0}],[{"node":"Get a draft2","type":"main","index":0}]]},"Wait18":{"main":[[{"node":"Loop Over Items18","type":"main","index":0}]]},"Merge4":{"main":[[{"node":"If13","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"735e280c-e93a-468c-ada9-cd62bf69b280","triggerCount":0,"shared":[{"updatedAt":"2025-12-11T08:33:33.457Z","createdAt":"2025-12-11T08:33:33.457Z","role":"workflow:owner","workflowId":"UuGlXqzkWJof7DaM","projectId":"Gh4K029Sunajg0dH"}],"tags":[]}